{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment } from \"vue\";\nconst _hoisted_1 = {\n  class: \"product-history\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"alert alert-danger\"\n};\nconst _hoisted_4 = {\n  key: 2\n};\nconst _hoisted_5 = {\n  key: 0\n};\nconst _hoisted_6 = {\n  key: 1\n};\nconst _hoisted_7 = {\n  key: 2\n};\nconst _hoisted_8 = [\"href\"];\nconst _hoisted_9 = [\"onClick\", \"disabled\"];\nconst _hoisted_10 = {\n  key: 3,\n  class: \"alert alert-danger\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[1] || (_cache[1] = _createElementVNode(\"h1\", null, \"商品历史记录\", -1 /* CACHED */)), $data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"加载中...\")) : _createCommentVNode(\"v-if\", true), $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, _toDisplayString($data.error), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), !$data.loading && $data.products.length > 0 ? (_openBlock(), _createElementBlock(\"table\", _hoisted_4, [_cache[0] || (_cache[0] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", null, \"ID\"), _createElementVNode(\"th\", null, \"名称\"), _createElementVNode(\"th\", null, \"价格\"), _createElementVNode(\"th\", null, \"状态\"), _createElementVNode(\"th\", null, \"创建时间\"), _createElementVNode(\"th\", null, \"操作\")])], -1 /* CACHED */)), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.products, product => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: product.id\n    }, [_createElementVNode(\"td\", null, _toDisplayString(product.id), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(product.name), 1 /* TEXT */), _createElementVNode(\"td\", null, \"¥\" + _toDisplayString(product.price.toFixed(2)), 1 /* TEXT */), _createElementVNode(\"td\", null, [product.isActive ? (_openBlock(), _createElementBlock(\"span\", _hoisted_5, \"在售\")) : (_openBlock(), _createElementBlock(\"span\", _hoisted_6, \"已下架\")), product.isFrozen ? (_openBlock(), _createElementBlock(\"span\", _hoisted_7, \" (已冻结)\")) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"td\", null, _toDisplayString($options.formatDate(product.createdAt)), 1 /* TEXT */), _createElementVNode(\"td\", null, [_createElementVNode(\"a\", {\n      href: '/seller/product/new?id=' + product.id,\n      class: \"btn\"\n    }, \"编辑\", 8 /* PROPS */, _hoisted_8), _createElementVNode(\"button\", {\n      class: \"btn btn-secondary\",\n      onClick: $event => $options.toggleActive(product),\n      disabled: product.isActive && $data.products.filter(p => p.isActive).length <= 1\n    }, _toDisplayString(product.isActive ? '下架' : '上架'), 9 /* TEXT, PROPS */, _hoisted_9)])]);\n  }), 128 /* KEYED_FRAGMENT */))])])) : _createCommentVNode(\"v-if\", true), !$data.loading && $data.products.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, \" 暂无商品记录 \")) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","$data","loading","_hoisted_2","error","_hoisted_3","_toDisplayString","products","length","_hoisted_4","_Fragment","_renderList","product","key","id","name","price","toFixed","isActive","_hoisted_5","_hoisted_6","isFrozen","_hoisted_7","$options","formatDate","createdAt","href","_hoisted_8","onClick","$event","toggleActive","disabled","filter","p","_hoisted_9","_hoisted_10"],"sources":["E:\\购物网站\\simple-shop-frontend\\frontend\\src\\views\\ProductHistory.vue"],"sourcesContent":["<template>\n  <div class=\"product-history\">\n    <h1>商品历史记录</h1>\n    \n    <div v-if=\"loading\" class=\"loading\">加载中...</div>\n    \n    <div v-if=\"error\" class=\"alert alert-danger\">\n      {{ error }}\n    </div>\n    \n    <table v-if=\"!loading && products.length > 0\">\n      <thead>\n        <tr>\n          <th>ID</th>\n          <th>名称</th>\n          <th>价格</th>\n          <th>状态</th>\n          <th>创建时间</th>\n          <th>操作</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"product in products\" :key=\"product.id\">\n          <td>{{ product.id }}</td>\n          <td>{{ product.name }}</td>\n          <td>¥{{ product.price.toFixed(2) }}</td>\n          <td>\n            <span v-if=\"product.isActive\">在售</span>\n            <span v-else>已下架</span>\n            <span v-if=\"product.isFrozen\"> (已冻结)</span>\n          </td>\n          <td>{{ formatDate(product.createdAt) }}</td>\n          <td>\n            <a :href=\"'/seller/product/new?id=' + product.id\" class=\"btn\">编辑</a>\n            <button \n              class=\"btn btn-secondary\" \n              @click=\"toggleActive(product)\"\n              :disabled=\"product.isActive && products.filter(p => p.isActive).length <= 1\">\n              {{ product.isActive ? '下架' : '上架' }}\n            </button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    \n    <div v-if=\"!loading && products.length === 0\" class=\"alert alert-danger\">\n      暂无商品记录\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'ProductHistory',\n  data() {\n    return {\n      products: [],\n      loading: true,\n      error: ''\n    }\n  },\n  created() {\n    this.fetchProducts()\n  },\n  methods: {\n    async fetchProducts() {\n      try {\n        this.loading = true\n     \n        const response = await this.$axios.get('/api/products')\n        this.products = response.data\n        this.error = ''\n      } catch (err) {\n        this.error = '获取商品历史失败'\n        console.error(err)\n      } finally {\n        this.loading = false\n      }\n    },\n    async toggleActive(product) {\n      try {\n        await this.$axios.put(`/products/${product.id}/freeze`, null, {\n          params: { freeze: false }\n        })\n        \n        await this.$axios.put(`/products/${product.id}`, {\n          ...product,\n          isActive: !product.isActive\n        })\n        \n        // 如果是上架操作，需要将其他所有商品下架\n        if (!product.isActive) {\n          for (const p of this.products) {\n            if (p.id !== product.id && p.isActive) {\n              await this.$axios.put(`/products/${p.id}`, {\n                ...p,\n                isActive: false\n              })\n            }\n          }\n        }\n        \n        this.fetchProducts()\n      } catch (err) {\n        this.error = '操作失败，请重试'\n        console.error(err)\n      }\n    },\n    formatDate(dateString) {\n      if (!dateString) return ''\n      const date = new Date(dateString)\n      return date.toLocaleString()\n    }\n  }\n}\n</script>\n\n<style scoped>\n.loading {\n  text-align: center;\n  padding: 2rem;\n  font-size: 1.2rem;\n}\n</style>\n"],"mappings":";;;;EACOA,KAAK,EAAC;AAAiB;;;EAGNA,KAAK,EAAC;;;;EAERA,KAAK,EAAC;;;;;;;;;;;;;;;;;;EAuCsBA,KAAK,EAAC;;;uBA5CtDC,mBAAA,CA+CM,OA/CNC,UA+CM,G,0BA9CJC,mBAAA,CAAe,YAAX,QAAM,qBAECC,KAAA,CAAAC,OAAO,I,cAAlBJ,mBAAA,CAAgD,OAAhDK,UAAgD,EAAZ,QAAM,K,mCAE/BF,KAAA,CAAAG,KAAK,I,cAAhBN,mBAAA,CAEM,OAFNO,UAEM,EAAAC,gBAAA,CADDL,KAAA,CAAAG,KAAK,oB,oCAGIH,KAAA,CAAAC,OAAO,IAAID,KAAA,CAAAM,QAAQ,CAACC,MAAM,Q,cAAxCV,mBAAA,CAiCQ,SAAAW,UAAA,G,0BAhCNT,mBAAA,CASQ,gBARNA,mBAAA,CAOK,aANHA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAa,YAAT,MAAI,GACRA,mBAAA,CAAW,YAAP,IAAE,E,uBAGVA,mBAAA,CAqBQ,iB,kBApBNF,mBAAA,CAmBKY,SAAA,QAAAC,WAAA,CAnBiBV,KAAA,CAAAM,QAAQ,EAAnBK,OAAO;yBAAlBd,mBAAA,CAmBK;MAnB4Be,GAAG,EAAED,OAAO,CAACE;QAC5Cd,mBAAA,CAAyB,YAAAM,gBAAA,CAAlBM,OAAO,CAACE,EAAE,kBACjBd,mBAAA,CAA2B,YAAAM,gBAAA,CAApBM,OAAO,CAACG,IAAI,kBACnBf,mBAAA,CAAwC,YAApC,GAAC,GAAAM,gBAAA,CAAGM,OAAO,CAACI,KAAK,CAACC,OAAO,qBAC7BjB,mBAAA,CAIK,aAHSY,OAAO,CAACM,QAAQ,I,cAA5BpB,mBAAA,CAAuC,QAAAqB,UAAA,EAAT,IAAE,M,cAChCrB,mBAAA,CAAuB,QAAAsB,UAAA,EAAV,KAAG,IACJR,OAAO,CAACS,QAAQ,I,cAA5BvB,mBAAA,CAA2C,QAAAwB,UAAA,EAAb,QAAM,K,qCAEtCtB,mBAAA,CAA4C,YAAAM,gBAAA,CAArCiB,QAAA,CAAAC,UAAU,CAACZ,OAAO,CAACa,SAAS,mBACnCzB,mBAAA,CAQK,aAPHA,mBAAA,CAAoE;MAAhE0B,IAAI,8BAA8Bd,OAAO,CAACE,EAAE;MAAEjB,KAAK,EAAC;OAAM,IAAE,iBAAA8B,UAAA,GAChE3B,mBAAA,CAKS;MAJPH,KAAK,EAAC,mBAAmB;MACxB+B,OAAK,EAAAC,MAAA,IAAEN,QAAA,CAAAO,YAAY,CAAClB,OAAO;MAC3BmB,QAAQ,EAAEnB,OAAO,CAACM,QAAQ,IAAIjB,KAAA,CAAAM,QAAQ,CAACyB,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACf,QAAQ,EAAEV,MAAM;wBACnEI,OAAO,CAACM,QAAQ,sCAAAgB,UAAA,E;4EAOjBjC,KAAA,CAAAC,OAAO,IAAID,KAAA,CAAAM,QAAQ,CAACC,MAAM,U,cAAtCV,mBAAA,CAEM,OAFNqC,WAEM,EAFmE,UAEzE,K","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}