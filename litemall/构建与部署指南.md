# 拼夕夕在线购物系统 - 构建与部署指南

本项目是一个基于前后端分离架构的在线购物系统，后端使用Spring Boot开发，前端使用Vue 3开发。本文档提供了项目的构建、部署和运行指南。

## 1. 系统架构

- **后端**：Spring Boot 2.7.0 + JPA + MySQL
- **前端**：Vue 3 + Vue Router + Axios
- **数据库**：MySQL

## 2. 环境要求

### 2.1 后端环境

- **JDK**：Java 11或更高版本
- **Maven**：3.6.0或更高版本
- **MySQL**：8.0或更高版本

### 2.2 前端环境

- **Node.js**：14.x或更高版本
- **npm**：6.x或更高版本
- **Vue CLI**：已包含在项目依赖中

## 3. 后端构建

### 3.1 配置MySQL数据库

在开始构建前，确保MySQL数据库已安装并配置：

1. 创建数据库：
```sql
CREATE DATABASE simple_shop CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. 确保root用户有足够权限：
```sql
GRANT ALL PRIVILEGES ON simple_shop.* TO 'root'@'%' IDENTIFIED BY 'root';
FLUSH PRIVILEGES;
```

### 3.2 修改应用配置

项目已配置好默认的数据库连接信息，位于 `backend/src/main/resources/application.properties` 文件：

```properties
server.port=8081

spring.datasource.url=jdbc:mysql://localhost:3306/simple_shop?useSSL=false&serverTimezone=UTC
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=root

spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
```

如需修改数据库连接信息，请根据实际环境调整上述配置。

### 3.3 使用Maven构建后端

在 `backend` 目录下执行以下命令：

```bash
# 编译并打包
mvn clean package

# 跳过测试编译并打包
mvn clean package -DskipTests
```

构建成功后，会在 `backend/target` 目录下生成 `simple-shop-0.0.1-SNAPSHOT.jar` 文件。

## 4. 前端构建

### 4.1 安装依赖

在 `frontend` 目录下执行以下命令：

```bash
# 安装依赖
npm install
```

### 4.2 修改API配置

编辑 `frontend/src/main.js` 文件，确保API基础URL正确：

```javascript
// 配置Axios基础URL
axios.defaults.baseURL = 'http://localhost:8081/api';
```

### 4.3 构建前端

在 `frontend` 目录下执行以下命令：

```bash
# 开发模式运行
npm run serve

# 构建生产版本
npm run build
```

构建成功后，生产版本的文件会生成在 `frontend/dist` 目录下。

## 5. 部署

### 5.1 后端部署

#### 5.1.1 使用jar包直接运行

```bash
java -jar backend/target/simple-shop-0.0.1-SNAPSHOT.jar
```

#### 5.1.2 使用系统服务运行（Linux）

创建服务配置文件 `/etc/systemd/system/simple-shop.service`：

```
[Unit]
Description=Simple Shop Application
After=syslog.target

[Service]
User=appuser
ExecStart=/usr/bin/java -jar /path/to/simple-shop-0.0.1-SNAPSHOT.jar
SuccessExitStatus=143

[Install]
WantedBy=multi-user.target
```

启动服务：

```bash
sudo systemctl daemon-reload
sudo systemctl start simple-shop
sudo systemctl enable simple-shop
```

### 5.2 前端部署

#### 5.2.1 使用Nginx部署前端

1. 安装Nginx

2. 配置Nginx：

```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        root /path/to/frontend/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # API代理
    location /api {
        proxy_pass http://localhost:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

3. 重启Nginx：

```bash
sudo systemctl restart nginx
```

## 6. 使用Docker部署

### 6.1 构建Docker镜像

在项目根目录创建以下文件：

#### 6.1.1 Dockerfile（后端）

```dockerfile
FROM openjdk:11-jre-slim

WORKDIR /app

COPY backend/target/simple-shop-0.0.1-SNAPSHOT.jar app.jar

EXPOSE 8081

ENTRYPOINT ["java", "-jar", "app.jar"]
```

#### 6.1.2 Dockerfile（前端）

```dockerfile
FROM node:14-alpine as build

WORKDIR /app

COPY frontend/package*.json ./
RUN npm install

COPY frontend/ .
RUN npm run build

FROM nginx:alpine

COPY --from=build /app/dist /usr/share/nginx/html
COPY frontend/nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

#### 6.1.3 docker-compose.yml

```yaml
version: '3'

services:
  db:
    image: mysql:8.0
    restart: always
    environment:
      MYSQL_DATABASE: 'simple_shop'
      MYSQL_USER: 'shop_user'
      MYSQL_PASSWORD: 'password'
      MYSQL_ROOT_PASSWORD: 'root_password'
    ports:
      - '3306:3306'
    volumes:
      - mysql-data:/var/lib/mysql

  backend:
    build:
      context: .
      dockerfile: Dockerfile-backend
    restart: always
    ports:
      - '8081:8081'
    depends_on:
      - db
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://db:3306/simple_shop?useSSL=false&serverTimezone=UTC
      SPRING_DATASOURCE_USERNAME: shop_user
      SPRING_DATASOURCE_PASSWORD: password

  frontend:
    build:
      context: .
      dockerfile: Dockerfile-frontend
    restart: always
    ports:
      - '80:80'
    depends_on:
      - backend

volumes:
  mysql-data:
```

### 6.2 运行Docker容器

在项目根目录执行以下命令：

```bash
docker-compose up -d
```

## 7. 系统测试

### 7.1 健康检查

后端服务启动后，可以访问以下地址检查服务状态：

```
http://localhost:8081/actuator/health
```

### 7.2 API文档

如果项目集成了Swagger，可以访问以下地址查看API文档：

```
http://localhost:8081/swagger-ui.html
```

### 7.3 前端访问

前端部署后，可以通过以下地址访问：

```
http://localhost:8080/
```

## 8. 常见问题

### 8.1 端口冲突

如果8081端口被占用，可以修改 `application.properties` 文件中的端口配置：

```properties
server.port=8082
```

### 8.2 数据库连接失败

检查数据库配置是否正确，确保MySQL服务正在运行，且用户有足够的权限。

### 8.3 跨域访问问题

如果遇到跨域访问问题，请确保 `WebConfig.java` 中的CORS配置正确。

---

本文档提供了拼夕夕在线购物系统的构建和部署指南，如有问题，请联系开发团队。