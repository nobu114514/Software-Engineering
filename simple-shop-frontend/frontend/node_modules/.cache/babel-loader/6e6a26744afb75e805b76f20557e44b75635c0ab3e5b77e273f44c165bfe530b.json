{"ast":null,"code":"import { toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"editor-container\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"editor-label\"\n};\nconst _hoisted_3 = [\"contenteditable\", \"innerHTML\"];\nconst _hoisted_4 = {\n  key: 1,\n  class: \"toolbar\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$props.label ? (_openBlock(), _createElementBlock(\"label\", _hoisted_2, _toDisplayString($props.label), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", {\n    ref: \"editorRef\",\n    class: \"rich-text-editor\",\n    contenteditable: !$props.disabled,\n    innerHTML: $data.localValue,\n    onInput: _cache[0] || (_cache[0] = $event => $options.updateContent($event))\n  }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_3), !$props.disabled ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createElementVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = $event => $options.formatText('bold'))\n  }, \"粗体\"), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = $event => $options.formatText('italic'))\n  }, \"斜体\"), _createElementVNode(\"button\", {\n    onClick: _cache[3] || (_cache[3] = $event => $options.formatText('underline'))\n  }, \"下划线\"), _createElementVNode(\"button\", {\n    onClick: _cache[4] || (_cache[4] = (...args) => $options.insertImage && $options.insertImage(...args))\n  }, \"插入图片\"), _createElementVNode(\"input\", {\n    ref: \"fileInput\",\n    type: \"file\",\n    accept: \"image/*\",\n    style: {\n      \"display\": \"none\"\n    },\n    onChange: _cache[5] || (_cache[5] = (...args) => $options.handleImageUpload && $options.handleImageUpload(...args))\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","$props","label","_hoisted_2","_toDisplayString","_createElementVNode","ref","contenteditable","disabled","innerHTML","$data","localValue","onInput","_cache","$event","$options","updateContent","_hoisted_4","onClick","formatText","args","insertImage","type","accept","style","onChange","handleImageUpload"],"sources":["E:\\Software-Engineering\\litemall\\simple-shop-frontend\\frontend\\src\\components\\RichTextEditor.vue"],"sourcesContent":["<template>\n  <div class=\"editor-container\">\n    <label v-if=\"label\" class=\"editor-label\">{{ label }}</label>\n    <div ref=\"editorRef\" class=\"rich-text-editor\"\n         :contenteditable=\"!disabled\"\n         v-html=\"localValue\"\n         @input=\"updateContent($event)\"></div>\n    <div class=\"toolbar\" v-if=\"!disabled\">\n      <button @click=\"formatText('bold')\">粗体</button>\n      <button @click=\"formatText('italic')\">斜体</button>\n      <button @click=\"formatText('underline')\">下划线</button>\n      <button @click=\"insertImage\">插入图片</button>\n      <input ref=\"fileInput\" type=\"file\" accept=\"image/*\" style=\"display: none\" @change=\"handleImageUpload\">\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'RichTextEditor',\n  props: {\n    modelValue: {\n      type: String,\n      default: ''\n    },\n    label: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      localValue: this.modelValue\n    }\n  },\n  watch: {\n    modelValue(newVal) {\n      if (newVal !== this.localValue && !this.$refs.editorRef?.isContentEditable) {\n        this.localValue = newVal\n      }\n    }\n  },\n  methods: {\n    updateContent(event) {\n      // 保存当前光标位置\n      const selection = window.getSelection()\n      let range = null\n      if (selection.rangeCount > 0) {\n        range = selection.getRangeAt(0).cloneRange()\n      }\n      \n      // 更新内容\n      this.localValue = this.$refs.editorRef.innerHTML\n      this.$emit('update:modelValue', this.localValue)\n      \n      // 恢复光标位置\n      if (range && this.$refs.editorRef.isContentEditable) {\n        setTimeout(() => {\n          const newSelection = window.getSelection()\n          newSelection.removeAllRanges()\n          newSelection.addRange(range)\n          this.$refs.editorRef.focus()\n        }, 0)\n      }\n    },\n    formatText(command) {\n      document.execCommand(command, false, null)\n      this.$refs.editorRef.focus()\n      this.updateContent()\n    },\n    insertImage() {\n      this.$refs.fileInput.click()\n    },\n    handleImageUpload(event) {\n      const file = event.target.files[0]\n      if (!file) return\n      \n      const formData = new FormData()\n      formData.append('files', file)\n      \n      // 使用Vue中的axios实例（如果可用）或原生fetch\n      const uploadPromise = this.$axios ? \n        this.$axios.post('/api/files/upload/images', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        }) : \n        fetch('/api/files/upload/images', {\n          method: 'POST',\n          body: formData,\n          credentials: 'include' // 确保发送cookies，可能需要身份验证\n        }).then(response => {\n          if (!response.ok) {\n            throw new Error(`HTTP error! Status: ${response.status}`)\n          }\n          return response.json()\n        });\n      \n      uploadPromise\n        .then(data => {\n          // 检查不同的响应格式\n          if (data && (data.imageUrls || data.url)) {\n            const imageUrl = data.imageUrls?.[0] || data.url\n            this.insertImageToEditor(imageUrl)\n          } else {\n            alert('上传失败: ' + (data?.errors?.[0] || data?.error || '未知错误'))\n          }\n        })\n        .catch(error => {\n          console.error('图片上传错误:', error)\n          alert('上传失败: ' + (error.response?.data?.message || error.message || '网络错误'))\n        })\n        .finally(() => {\n          // 清空文件输入，允许重复上传相同文件\n          event.target.value = ''\n        })\n    },\n    insertImageToEditor(imageUrl) {\n      // 创建图片元素\n      const img = document.createElement('img')\n      img.src = imageUrl\n      img.style.maxWidth = '100%'\n      \n      // 获取当前选中区域\n      const selection = window.getSelection()\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0)\n        range.deleteContents()\n        range.insertNode(img)\n        // 将光标移动到图片后面\n        range.setStartAfter(img)\n        range.setEndAfter(img)\n        selection.removeAllRanges()\n        selection.addRange(range)\n      } else {\n        // 如果没有选中区域，直接追加到编辑器末尾\n        this.$refs.editorRef.appendChild(img)\n      }\n      \n      this.updateContent()\n      this.$refs.editorRef.focus()\n    },\n    // 获取编辑器内容\n    getContent() {\n      return this.localValue\n    },\n    // 设置编辑器内容\n    setContent(content) {\n      this.localValue = content\n      this.$emit('update:modelValue', content)\n    },\n    // 清空编辑器\n    clear() {\n      this.localValue = ''\n      this.$emit('update:modelValue', '')\n    }\n  }\n}\n</script>\n\n<style scoped>\n.editor-container {\n  margin-bottom: 20px;\n}\n\n.editor-label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 500;\n  color: #333;\n}\n</style>"],"mappings":";;EACOA,KAAK,EAAC;AAAkB;;;EACPA,KAAK,EAAC;;;;;EAKrBA,KAAK,EAAC;;;uBANbC,mBAAA,CAaM,OAbNC,UAaM,GAZSC,MAAA,CAAAC,KAAK,I,cAAlBH,mBAAA,CAA4D,SAA5DI,UAA4D,EAAAC,gBAAA,CAAhBH,MAAA,CAAAC,KAAK,oB,mCACjDG,mBAAA,CAG0C;IAHrCC,GAAG,EAAC,WAAW;IAACR,KAAK,EAAC,kBAAkB;IACvCS,eAAe,GAAGN,MAAA,CAAAO,QAAQ;IAC3BC,SAAmB,EAAXC,KAAA,CAAAC,UAAU;IACjBC,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEC,QAAA,CAAAC,aAAa,CAACF,MAAM;yDACLb,MAAA,CAAAO,QAAQ,I,cAApCT,mBAAA,CAMM,OANNkB,UAMM,GALJZ,mBAAA,CAA+C;IAAtCa,OAAK,EAAAL,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEC,QAAA,CAAAI,UAAU;KAAU,IAAE,GACtCd,mBAAA,CAAiD;IAAxCa,OAAK,EAAAL,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEC,QAAA,CAAAI,UAAU;KAAY,IAAE,GACxCd,mBAAA,CAAqD;IAA5Ca,OAAK,EAAAL,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEC,QAAA,CAAAI,UAAU;KAAe,KAAG,GAC5Cd,mBAAA,CAA0C;IAAjCa,OAAK,EAAAL,MAAA,QAAAA,MAAA,UAAAO,IAAA,KAAEL,QAAA,CAAAM,WAAA,IAAAN,QAAA,CAAAM,WAAA,IAAAD,IAAA,CAAW;KAAE,MAAI,GACjCf,mBAAA,CAAsG;IAA/FC,GAAG,EAAC,WAAW;IAACgB,IAAI,EAAC,MAAM;IAACC,MAAM,EAAC,SAAS;IAACC,KAAqB,EAArB;MAAA;IAAA,CAAqB;IAAEC,QAAM,EAAAZ,MAAA,QAAAA,MAAA,UAAAO,IAAA,KAAEL,QAAA,CAAAW,iBAAA,IAAAX,QAAA,CAAAW,iBAAA,IAAAN,IAAA,CAAiB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}