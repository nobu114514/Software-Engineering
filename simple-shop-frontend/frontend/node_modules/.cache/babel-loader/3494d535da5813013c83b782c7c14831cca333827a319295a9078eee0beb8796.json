{"ast":null,"code":"export default {\n  name: 'RichTextEditor',\n  props: {\n    modelValue: {\n      type: String,\n      default: ''\n    },\n    label: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      localValue: this.modelValue\n    };\n  },\n  watch: {\n    modelValue(newVal) {\n      if (newVal !== this.localValue && !this.$refs.editorRef?.isContentEditable) {\n        this.localValue = newVal;\n      }\n    }\n  },\n  methods: {\n    updateContent(event) {\n      // 保存当前光标位置\n      const selection = window.getSelection();\n      let range = null;\n      if (selection.rangeCount > 0) {\n        range = selection.getRangeAt(0).cloneRange();\n      }\n\n      // 更新内容\n      this.localValue = this.$refs.editorRef.innerHTML;\n      this.$emit('update:modelValue', this.localValue);\n\n      // 恢复光标位置\n      if (range && this.$refs.editorRef.isContentEditable) {\n        setTimeout(() => {\n          const newSelection = window.getSelection();\n          newSelection.removeAllRanges();\n          newSelection.addRange(range);\n          this.$refs.editorRef.focus();\n        }, 0);\n      }\n    },\n    formatText(command) {\n      document.execCommand(command, false, null);\n      this.$refs.editorRef.focus();\n      this.updateContent();\n    },\n    insertImage() {\n      this.$refs.fileInput.click();\n    },\n    handleImageUpload(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n      const formData = new FormData();\n      formData.append('files', file);\n\n      // 使用Vue中的axios实例（如果可用）或原生fetch\n      const uploadPromise = this.$axios ? this.$axios.post('/api/files/upload/images', formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }) : fetch('/api/files/upload/images', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include' // 确保发送cookies，可能需要身份验证\n      }).then(response => {\n        if (!response.ok) {\n          throw new Error(`HTTP error! Status: ${response.status}`);\n        }\n        return response.json();\n      });\n      uploadPromise.then(data => {\n        // 检查不同的响应格式\n        if (data && (data.imageUrls || data.url)) {\n          const imageUrl = data.imageUrls?.[0] || data.url;\n          this.insertImageToEditor(imageUrl);\n        } else {\n          alert('上传失败: ' + (data?.errors?.[0] || data?.error || '未知错误'));\n        }\n      }).catch(error => {\n        console.error('图片上传错误:', error);\n        alert('上传失败: ' + (error.response?.data?.message || error.message || '网络错误'));\n      }).finally(() => {\n        // 清空文件输入，允许重复上传相同文件\n        event.target.value = '';\n      });\n    },\n    insertImageToEditor(imageUrl) {\n      // 创建图片元素\n      const img = document.createElement('img');\n      img.src = imageUrl;\n      img.style.maxWidth = '100%';\n\n      // 获取当前选中区域\n      const selection = window.getSelection();\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        range.deleteContents();\n        range.insertNode(img);\n        // 将光标移动到图片后面\n        range.setStartAfter(img);\n        range.setEndAfter(img);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      } else {\n        // 如果没有选中区域，直接追加到编辑器末尾\n        this.$refs.editorRef.appendChild(img);\n      }\n      this.updateContent();\n      this.$refs.editorRef.focus();\n    },\n    // 获取编辑器内容\n    getContent() {\n      return this.localValue;\n    },\n    // 设置编辑器内容\n    setContent(content) {\n      this.localValue = content;\n      this.$emit('update:modelValue', content);\n    },\n    // 清空编辑器\n    clear() {\n      this.localValue = '';\n      this.$emit('update:modelValue', '');\n    }\n  }\n};","map":{"version":3,"names":["name","props","modelValue","type","String","default","label","disabled","Boolean","data","localValue","watch","newVal","$refs","editorRef","isContentEditable","methods","updateContent","event","selection","window","getSelection","range","rangeCount","getRangeAt","cloneRange","innerHTML","$emit","setTimeout","newSelection","removeAllRanges","addRange","focus","formatText","command","document","execCommand","insertImage","fileInput","click","handleImageUpload","file","target","files","formData","FormData","append","uploadPromise","$axios","post","headers","fetch","method","body","credentials","then","response","ok","Error","status","json","imageUrls","url","imageUrl","insertImageToEditor","alert","errors","error","catch","console","message","finally","value","img","createElement","src","style","maxWidth","deleteContents","insertNode","setStartAfter","setEndAfter","appendChild","getContent","setContent","content","clear"],"sources":["E:\\Software-Engineering\\litemall\\simple-shop-frontend\\frontend\\src\\components\\RichTextEditor.vue"],"sourcesContent":["<template>\n  <div class=\"editor-container\">\n    <label v-if=\"label\" class=\"editor-label\">{{ label }}</label>\n    <div ref=\"editorRef\" class=\"rich-text-editor\"\n         :contenteditable=\"!disabled\"\n         v-html=\"localValue\"\n         @input=\"updateContent($event)\"></div>\n    <div class=\"toolbar\" v-if=\"!disabled\">\n      <button @click=\"formatText('bold')\">粗体</button>\n      <button @click=\"formatText('italic')\">斜体</button>\n      <button @click=\"formatText('underline')\">下划线</button>\n      <button @click=\"insertImage\">插入图片</button>\n      <input ref=\"fileInput\" type=\"file\" accept=\"image/*\" style=\"display: none\" @change=\"handleImageUpload\">\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'RichTextEditor',\n  props: {\n    modelValue: {\n      type: String,\n      default: ''\n    },\n    label: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      localValue: this.modelValue\n    }\n  },\n  watch: {\n    modelValue(newVal) {\n      if (newVal !== this.localValue && !this.$refs.editorRef?.isContentEditable) {\n        this.localValue = newVal\n      }\n    }\n  },\n  methods: {\n    updateContent(event) {\n      // 保存当前光标位置\n      const selection = window.getSelection()\n      let range = null\n      if (selection.rangeCount > 0) {\n        range = selection.getRangeAt(0).cloneRange()\n      }\n      \n      // 更新内容\n      this.localValue = this.$refs.editorRef.innerHTML\n      this.$emit('update:modelValue', this.localValue)\n      \n      // 恢复光标位置\n      if (range && this.$refs.editorRef.isContentEditable) {\n        setTimeout(() => {\n          const newSelection = window.getSelection()\n          newSelection.removeAllRanges()\n          newSelection.addRange(range)\n          this.$refs.editorRef.focus()\n        }, 0)\n      }\n    },\n    formatText(command) {\n      document.execCommand(command, false, null)\n      this.$refs.editorRef.focus()\n      this.updateContent()\n    },\n    insertImage() {\n      this.$refs.fileInput.click()\n    },\n    handleImageUpload(event) {\n      const file = event.target.files[0]\n      if (!file) return\n      \n      const formData = new FormData()\n      formData.append('files', file)\n      \n      // 使用Vue中的axios实例（如果可用）或原生fetch\n      const uploadPromise = this.$axios ? \n        this.$axios.post('/api/files/upload/images', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        }) : \n        fetch('/api/files/upload/images', {\n          method: 'POST',\n          body: formData,\n          credentials: 'include' // 确保发送cookies，可能需要身份验证\n        }).then(response => {\n          if (!response.ok) {\n            throw new Error(`HTTP error! Status: ${response.status}`)\n          }\n          return response.json()\n        });\n      \n      uploadPromise\n        .then(data => {\n          // 检查不同的响应格式\n          if (data && (data.imageUrls || data.url)) {\n            const imageUrl = data.imageUrls?.[0] || data.url\n            this.insertImageToEditor(imageUrl)\n          } else {\n            alert('上传失败: ' + (data?.errors?.[0] || data?.error || '未知错误'))\n          }\n        })\n        .catch(error => {\n          console.error('图片上传错误:', error)\n          alert('上传失败: ' + (error.response?.data?.message || error.message || '网络错误'))\n        })\n        .finally(() => {\n          // 清空文件输入，允许重复上传相同文件\n          event.target.value = ''\n        })\n    },\n    insertImageToEditor(imageUrl) {\n      // 创建图片元素\n      const img = document.createElement('img')\n      img.src = imageUrl\n      img.style.maxWidth = '100%'\n      \n      // 获取当前选中区域\n      const selection = window.getSelection()\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0)\n        range.deleteContents()\n        range.insertNode(img)\n        // 将光标移动到图片后面\n        range.setStartAfter(img)\n        range.setEndAfter(img)\n        selection.removeAllRanges()\n        selection.addRange(range)\n      } else {\n        // 如果没有选中区域，直接追加到编辑器末尾\n        this.$refs.editorRef.appendChild(img)\n      }\n      \n      this.updateContent()\n      this.$refs.editorRef.focus()\n    },\n    // 获取编辑器内容\n    getContent() {\n      return this.localValue\n    },\n    // 设置编辑器内容\n    setContent(content) {\n      this.localValue = content\n      this.$emit('update:modelValue', content)\n    },\n    // 清空编辑器\n    clear() {\n      this.localValue = ''\n      this.$emit('update:modelValue', '')\n    }\n  }\n}\n</script>\n\n<style scoped>\n.editor-container {\n  margin-bottom: 20px;\n}\n\n.editor-label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 500;\n  color: #333;\n}\n</style>"],"mappings":"AAkBA,eAAe;EACbA,IAAI,EAAE,gBAAgB;EACtBC,KAAK,EAAE;IACLC,UAAU,EAAE;MACVC,IAAI,EAAEC,MAAM;MACZC,OAAO,EAAE;IACX,CAAC;IACDC,KAAK,EAAE;MACLH,IAAI,EAAEC,MAAM;MACZC,OAAO,EAAE;IACX,CAAC;IACDE,QAAQ,EAAE;MACRJ,IAAI,EAAEK,OAAO;MACbH,OAAO,EAAE;IACX;EACF,CAAC;EACDI,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,UAAU,EAAE,IAAI,CAACR;IACnB;EACF,CAAC;EACDS,KAAK,EAAE;IACLT,UAAUA,CAACU,MAAM,EAAE;MACjB,IAAIA,MAAK,KAAM,IAAI,CAACF,UAAS,IAAK,CAAC,IAAI,CAACG,KAAK,CAACC,SAAS,EAAEC,iBAAiB,EAAE;QAC1E,IAAI,CAACL,UAAS,GAAIE,MAAK;MACzB;IACF;EACF,CAAC;EACDI,OAAO,EAAE;IACPC,aAAaA,CAACC,KAAK,EAAE;MACnB;MACA,MAAMC,SAAQ,GAAIC,MAAM,CAACC,YAAY,CAAC;MACtC,IAAIC,KAAI,GAAI,IAAG;MACf,IAAIH,SAAS,CAACI,UAAS,GAAI,CAAC,EAAE;QAC5BD,KAAI,GAAIH,SAAS,CAACK,UAAU,CAAC,CAAC,CAAC,CAACC,UAAU,CAAC;MAC7C;;MAEA;MACA,IAAI,CAACf,UAAS,GAAI,IAAI,CAACG,KAAK,CAACC,SAAS,CAACY,SAAQ;MAC/C,IAAI,CAACC,KAAK,CAAC,mBAAmB,EAAE,IAAI,CAACjB,UAAU;;MAE/C;MACA,IAAIY,KAAI,IAAK,IAAI,CAACT,KAAK,CAACC,SAAS,CAACC,iBAAiB,EAAE;QACnDa,UAAU,CAAC,MAAM;UACf,MAAMC,YAAW,GAAIT,MAAM,CAACC,YAAY,CAAC;UACzCQ,YAAY,CAACC,eAAe,CAAC;UAC7BD,YAAY,CAACE,QAAQ,CAACT,KAAK;UAC3B,IAAI,CAACT,KAAK,CAACC,SAAS,CAACkB,KAAK,CAAC;QAC7B,CAAC,EAAE,CAAC;MACN;IACF,CAAC;IACDC,UAAUA,CAACC,OAAO,EAAE;MAClBC,QAAQ,CAACC,WAAW,CAACF,OAAO,EAAE,KAAK,EAAE,IAAI;MACzC,IAAI,CAACrB,KAAK,CAACC,SAAS,CAACkB,KAAK,CAAC;MAC3B,IAAI,CAACf,aAAa,CAAC;IACrB,CAAC;IACDoB,WAAWA,CAAA,EAAG;MACZ,IAAI,CAACxB,KAAK,CAACyB,SAAS,CAACC,KAAK,CAAC;IAC7B,CAAC;IACDC,iBAAiBA,CAACtB,KAAK,EAAE;MACvB,MAAMuB,IAAG,GAAIvB,KAAK,CAACwB,MAAM,CAACC,KAAK,CAAC,CAAC;MACjC,IAAI,CAACF,IAAI,EAAE;MAEX,MAAMG,QAAO,GAAI,IAAIC,QAAQ,CAAC;MAC9BD,QAAQ,CAACE,MAAM,CAAC,OAAO,EAAEL,IAAI;;MAE7B;MACA,MAAMM,aAAY,GAAI,IAAI,CAACC,MAAK,GAC9B,IAAI,CAACA,MAAM,CAACC,IAAI,CAAC,0BAA0B,EAAEL,QAAQ,EAAE;QACrDM,OAAO,EAAE;UACP,cAAc,EAAE;QAClB;MACF,CAAC,IACDC,KAAK,CAAC,0BAA0B,EAAE;QAChCC,MAAM,EAAE,MAAM;QACdC,IAAI,EAAET,QAAQ;QACdU,WAAW,EAAE,SAAQ,CAAE;MACzB,CAAC,CAAC,CAACC,IAAI,CAACC,QAAO,IAAK;QAClB,IAAI,CAACA,QAAQ,CAACC,EAAE,EAAE;UAChB,MAAM,IAAIC,KAAK,CAAC,uBAAuBF,QAAQ,CAACG,MAAM,EAAE;QAC1D;QACA,OAAOH,QAAQ,CAACI,IAAI,CAAC;MACvB,CAAC,CAAC;MAEJb,aAAY,CACTQ,IAAI,CAAC9C,IAAG,IAAK;QACZ;QACA,IAAIA,IAAG,KAAMA,IAAI,CAACoD,SAAQ,IAAKpD,IAAI,CAACqD,GAAG,CAAC,EAAE;UACxC,MAAMC,QAAO,GAAItD,IAAI,CAACoD,SAAS,GAAG,CAAC,KAAKpD,IAAI,CAACqD,GAAE;UAC/C,IAAI,CAACE,mBAAmB,CAACD,QAAQ;QACnC,OAAO;UACLE,KAAK,CAAC,QAAO,IAAKxD,IAAI,EAAEyD,MAAM,GAAG,CAAC,KAAKzD,IAAI,EAAE0D,KAAI,IAAK,MAAM,CAAC;QAC/D;MACF,CAAC,EACAC,KAAK,CAACD,KAAI,IAAK;QACdE,OAAO,CAACF,KAAK,CAAC,SAAS,EAAEA,KAAK;QAC9BF,KAAK,CAAC,QAAO,IAAKE,KAAK,CAACX,QAAQ,EAAE/C,IAAI,EAAE6D,OAAM,IAAKH,KAAK,CAACG,OAAM,IAAK,MAAM,CAAC;MAC7E,CAAC,EACAC,OAAO,CAAC,MAAM;QACb;QACArD,KAAK,CAACwB,MAAM,CAAC8B,KAAI,GAAI,EAAC;MACxB,CAAC;IACL,CAAC;IACDR,mBAAmBA,CAACD,QAAQ,EAAE;MAC5B;MACA,MAAMU,GAAE,GAAItC,QAAQ,CAACuC,aAAa,CAAC,KAAK;MACxCD,GAAG,CAACE,GAAE,GAAIZ,QAAO;MACjBU,GAAG,CAACG,KAAK,CAACC,QAAO,GAAI,MAAK;;MAE1B;MACA,MAAM1D,SAAQ,GAAIC,MAAM,CAACC,YAAY,CAAC;MACtC,IAAIF,SAAS,CAACI,UAAS,GAAI,CAAC,EAAE;QAC5B,MAAMD,KAAI,GAAIH,SAAS,CAACK,UAAU,CAAC,CAAC;QACpCF,KAAK,CAACwD,cAAc,CAAC;QACrBxD,KAAK,CAACyD,UAAU,CAACN,GAAG;QACpB;QACAnD,KAAK,CAAC0D,aAAa,CAACP,GAAG;QACvBnD,KAAK,CAAC2D,WAAW,CAACR,GAAG;QACrBtD,SAAS,CAACW,eAAe,CAAC;QAC1BX,SAAS,CAACY,QAAQ,CAACT,KAAK;MAC1B,OAAO;QACL;QACA,IAAI,CAACT,KAAK,CAACC,SAAS,CAACoE,WAAW,CAACT,GAAG;MACtC;MAEA,IAAI,CAACxD,aAAa,CAAC;MACnB,IAAI,CAACJ,KAAK,CAACC,SAAS,CAACkB,KAAK,CAAC;IAC7B,CAAC;IACD;IACAmD,UAAUA,CAAA,EAAG;MACX,OAAO,IAAI,CAACzE,UAAS;IACvB,CAAC;IACD;IACA0E,UAAUA,CAACC,OAAO,EAAE;MAClB,IAAI,CAAC3E,UAAS,GAAI2E,OAAM;MACxB,IAAI,CAAC1D,KAAK,CAAC,mBAAmB,EAAE0D,OAAO;IACzC,CAAC;IACD;IACAC,KAAKA,CAAA,EAAG;MACN,IAAI,CAAC5E,UAAS,GAAI,EAAC;MACnB,IAAI,CAACiB,KAAK,CAAC,mBAAmB,EAAE,EAAE;IACpC;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}