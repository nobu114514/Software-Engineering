{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport RichTextEditor from '../components/RichTextEditor.vue';\nexport default {\n  name: 'ProductForm',\n  components: {\n    RichTextEditor\n  },\n  data() {\n    return {\n      product: {\n        name: '',\n        price: 0,\n        imageUrl: '',\n        description: '',\n        subCategory: null\n      },\n      isEditing: false,\n      loading: true,\n      error: '',\n      success: false,\n      categories: [],\n      subCategories: [],\n      selectedCategoryId: null\n    };\n  },\n  created() {\n    const productId = this.$route.query.id;\n    if (productId) {\n      this.isEditing = true;\n      Promise.all([this.fetchCategories(), this.fetchProduct(productId)]).finally(() => {\n        this.loading = false;\n      });\n    } else {\n      this.fetchCategories().finally(() => {\n        this.loading = false;\n      });\n    }\n  },\n  watch: {\n    selectedCategoryId(newVal) {\n      this.loadSubCategories(newVal);\n    }\n  },\n  methods: {\n    async fetchCategories() {\n      try {\n        const response = await this.$axios.get('http://localhost:8081/api/categories/active');\n        // 正确访问嵌套在data字段中的分类列表\n        this.categories = response.data.data || [];\n        // 如果有分类且不是编辑模式，自动选择第一个分类\n        if (this.categories.length > 0 && !this.isEditing && !this.selectedCategoryId) {\n          this.selectedCategoryId = this.categories[0].id;\n        }\n      } catch (err) {\n        console.error('获取分类信息失败', err);\n      }\n    },\n    async loadSubCategories(categoryId) {\n      if (!categoryId) {\n        this.subCategories = [];\n        this.product.subCategory = null;\n        return;\n      }\n      try {\n        const response = await this.$axios.get(`http://localhost:8081/api/sub-categories/category/${categoryId}`);\n        // SubCategoryController直接返回列表，不包含data字段\n        this.subCategories = Array.isArray(response.data) ? response.data : [];\n        // 如果有子分类且之前没有选择过，自动选择第一个子分类\n        if (this.subCategories.length > 0 && !this.product.subCategory) {\n          this.product.subCategory = this.subCategories[0];\n        }\n      } catch (err) {\n        console.error('获取二级分类信息失败', err);\n      }\n    },\n    async fetchProduct(id) {\n      try {\n        const response = await this.$axios.get(`http://localhost:8081/api/products/${id}`);\n        // 正确访问嵌套在data字段中的商品数据\n        this.product = response.data.data || response.data;\n        // 如果商品有二级分类，设置选中的分类\n        if (this.product.subCategory && this.product.subCategory.category) {\n          this.selectedCategoryId = this.product.subCategory.category.id;\n          // 等待分类列表加载完成后再加载二级分类\n          await this.$nextTick();\n          this.loadSubCategories(this.selectedCategoryId);\n        }\n        this.error = '';\n      } catch (err) {\n        this.error = '获取商品信息失败';\n        console.error(err);\n      }\n    },\n    goToBatchPublish() {\n      this.$router.push('/seller/product/batch');\n    },\n    async saveProduct() {\n      try {\n        if (this.isEditing) {\n          await this.$axios.put(`http://localhost:8081/api/products/${this.product.id}`, this.product);\n        } else {\n          await this.$axios.post('http://localhost:8081/api/products', this.product);\n        }\n        this.success = true;\n        // 重置表单或跳转\n        setTimeout(() => {\n          this.$router.push('/seller/dashboard');\n        }, 1500);\n      } catch (err) {\n        this.error = this.isEditing ? '更新商品失败' : '发布商品失败';\n        console.error(err);\n      }\n    }\n  }\n};","map":{"version":3,"names":["RichTextEditor","name","components","data","product","price","imageUrl","description","subCategory","isEditing","loading","error","success","categories","subCategories","selectedCategoryId","created","productId","$route","query","id","Promise","all","fetchCategories","fetchProduct","finally","watch","newVal","loadSubCategories","methods","response","$axios","get","length","err","console","categoryId","Array","isArray","category","$nextTick","goToBatchPublish","$router","push","saveProduct","put","post","setTimeout"],"sources":["D:\\github\\最后一舞\\simple-shop-frontend\\frontend\\src\\views\\ProductForm.vue"],"sourcesContent":["<template>\r\n  <div class=\"product-form\">\r\n    <div class=\"header-section\">\r\n      <h1>{{ isEditing ? '编辑商品' : '发布新商品' }}</h1>\r\n      <button v-if=\"!isEditing\" @click=\"goToBatchPublish\" class=\"btn btn-primary batch-publish-btn\">批量发布</button>\r\n    </div>\r\n    \r\n    <div v-if=\"loading\" class=\"loading\">加载中...</div>\r\n    \r\n    <div v-if=\"error\" class=\"alert alert-danger\">\r\n      {{ error }}\r\n    </div>\r\n    \r\n    <div v-if=\"success\" class=\"alert alert-success\">\r\n      {{ isEditing ? '商品更新成功' : '商品发布成功' }}\r\n    </div>\r\n    \r\n    <form @submit.prevent=\"saveProduct\" v-if=\"!loading\" class=\"card\">\r\n      <div class=\"form-group\">\r\n        <label for=\"name\">商品名称</label>\r\n        <input type=\"text\" id=\"name\" v-model=\"product.name\" required>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"category\">商品分类</label>\r\n        <select id=\"category\" v-model=\"selectedCategoryId\" required>\r\n          <option v-for=\"category in categories\" :key=\"category.id\" :value=\"category.id\">\r\n            {{ category.name }}\r\n          </option>\r\n        </select>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"subCategory\">商品子分类</label>\r\n        <select id=\"subCategory\" v-model=\"product.subCategory\" required>\r\n          <option v-for=\"subCategory in subCategories\" :key=\"subCategory.id\" :value=\"subCategory\">\r\n            {{ subCategory.name }}\r\n          </option>\r\n        </select>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"price\">商品价格</label>\r\n        <input type=\"number\" id=\"price\" v-model=\"product.price\" min=\"0\" step=\"0.01\" required>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"imageUrl\">商品主图URL</label>\r\n        <input type=\"text\" id=\"imageUrl\" v-model=\"product.imageUrl\" \r\n               placeholder=\"输入图片URL，如：https://picsum.photos/600/400\">\r\n        <p class=\"help-text\">您也可以在下方的商品详情中插入更多图片</p>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>商品详情</label>\r\n        <RichTextEditor v-model=\"product.description\" label=\"\" />\r\n      </div>\r\n      <div class=\"form-actions\">\r\n        <button type=\"submit\" class=\"btn\">{{ isEditing ? '更新商品' : '发布商品' }}</button>\r\n        <a href=\"/seller/dashboard\" class=\"btn btn-secondary\">取消</a>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport RichTextEditor from '../components/RichTextEditor.vue'\r\n\r\nexport default {\r\n  name: 'ProductForm',\r\n  components: {\r\n    RichTextEditor\r\n  },\r\n  data() {\r\n    return {\r\n      product: {\r\n        name: '',\r\n        price: 0,\r\n        imageUrl: '',\r\n        description: '',\r\n        subCategory: null\r\n      },\r\n      isEditing: false,\r\n      loading: true,\r\n      error: '',\r\n      success: false,\r\n      categories: [],\r\n      subCategories: [],\r\n      selectedCategoryId: null\r\n    }\r\n  },\r\n  created() {\r\n    const productId = this.$route.query.id\r\n    if (productId) {\r\n      this.isEditing = true\r\n      Promise.all([this.fetchCategories(), this.fetchProduct(productId)])\r\n        .finally(() => {\r\n          this.loading = false\r\n        })\r\n    } else {\r\n      this.fetchCategories().finally(() => {\r\n        this.loading = false\r\n      })\r\n    }\r\n  },\r\n  watch: {\r\n    selectedCategoryId(newVal) {\r\n      this.loadSubCategories(newVal)\r\n    }\r\n  },\r\n  methods: {\r\n    async fetchCategories() {\r\n      try {\r\n        const response = await this.$axios.get('http://localhost:8081/api/categories/active')\r\n        // 正确访问嵌套在data字段中的分类列表\r\n        this.categories = response.data.data || []\r\n        // 如果有分类且不是编辑模式，自动选择第一个分类\r\n        if (this.categories.length > 0 && !this.isEditing && !this.selectedCategoryId) {\r\n          this.selectedCategoryId = this.categories[0].id\r\n        }\r\n      } catch (err) {\r\n        console.error('获取分类信息失败', err)\r\n      }\r\n    },\r\n    \r\n    async loadSubCategories(categoryId) {\r\n      if (!categoryId) {\r\n        this.subCategories = []\r\n        this.product.subCategory = null\r\n        return\r\n      }\r\n      try {\r\n        const response = await this.$axios.get(`http://localhost:8081/api/sub-categories/category/${categoryId}`)\r\n        // SubCategoryController直接返回列表，不包含data字段\r\n        this.subCategories = Array.isArray(response.data) ? response.data : []\r\n        // 如果有子分类且之前没有选择过，自动选择第一个子分类\r\n        if (this.subCategories.length > 0 && !this.product.subCategory) {\r\n          this.product.subCategory = this.subCategories[0]\r\n        }\r\n      } catch (err) {\r\n        console.error('获取二级分类信息失败', err)\r\n      }\r\n    },\r\n    \r\n    async fetchProduct(id) {\r\n      try {\r\n        const response = await this.$axios.get(`http://localhost:8081/api/products/${id}`)\r\n        // 正确访问嵌套在data字段中的商品数据\r\n        this.product = response.data.data || response.data\r\n        // 如果商品有二级分类，设置选中的分类\r\n        if (this.product.subCategory && this.product.subCategory.category) {\r\n          this.selectedCategoryId = this.product.subCategory.category.id\r\n          // 等待分类列表加载完成后再加载二级分类\r\n          await this.$nextTick()\r\n          this.loadSubCategories(this.selectedCategoryId)\r\n        }\r\n        this.error = ''\r\n      } catch (err) {\r\n        this.error = '获取商品信息失败'\r\n        console.error(err)\r\n      }\r\n    },\r\n    goToBatchPublish() {\r\n      this.$router.push('/seller/product/batch')\r\n    },\r\n    async saveProduct() {\r\n      try {\r\n        if (this.isEditing) {\r\n          await this.$axios.put(`http://localhost:8081/api/products/${this.product.id}`, this.product)\r\n        } else {\r\n          await this.$axios.post('http://localhost:8081/api/products', this.product)\r\n        }\r\n        this.success = true\r\n        // 重置表单或跳转\r\n        setTimeout(() => {\r\n          this.$router.push('/seller/dashboard')\r\n        }, 1500)\r\n      } catch (err) {\r\n        this.error = this.isEditing ? '更新商品失败' : '发布商品失败'\r\n        console.error(err)\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.header-section {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.batch-publish-btn {\r\n  padding: 0.5rem 1rem;\r\n}\r\n\r\n.form-actions {\r\n  margin-top: 1.5rem;\r\n  display: flex;\r\n  gap: 1rem;\r\n}\r\n\r\n.loading {\r\n  text-align: center;\r\n  padding: 2rem;\r\n  font-size: 1.2rem;\r\n}\r\n\r\n.form-group {\r\n  margin-bottom: 1rem;\r\n}\r\n\r\nlabel {\r\n  display: block;\r\n  margin-bottom: 0.5rem;\r\n  font-weight: 500;\r\n}\r\n\r\ninput[type=\"text\"],\r\ninput[type=\"number\"],\r\ntextarea {\r\n  width: 100%;\r\n  padding: 0.75rem;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n  font-size: 1rem;\r\n}\r\n\r\n.help-text {\r\n  margin-top: 0.5rem;\r\n  font-size: 0.875rem;\r\n  color: #666;\r\n}\r\n\r\n/* 富文本编辑器容器样式 */\r\n:deep(.rich-text-editor) {\r\n  min-height: 200px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n  padding: 1rem;\r\n  margin-bottom: 0.5rem;\r\n  outline: none;\r\n}\r\n\r\n:deep(.rich-text-editor:focus) {\r\n  border-color: #4a90e2;\r\n}\r\n\r\n:deep(.toolbar) {\r\n  display: flex;\r\n  gap: 0.5rem;\r\n  margin-bottom: 1rem;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n:deep(.toolbar button) {\r\n  padding: 0.5rem 0.75rem;\r\n  background-color: #f5f5f5;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n  font-size: 0.875rem;\r\n}\r\n\r\n:deep(.toolbar button:hover) {\r\n  background-color: #e9e9e9;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}