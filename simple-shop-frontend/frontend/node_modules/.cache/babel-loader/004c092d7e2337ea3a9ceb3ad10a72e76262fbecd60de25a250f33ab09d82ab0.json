{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nexport default {\n  name: 'ProductBatchForm',\n  components: {},\n  data() {\n    return {\n      products: [{\n        name: '',\n        categoryId: null,\n        subCategory: null,\n        price: 0,\n        theme: '',\n        description: ''\n      }],\n      loading: true,\n      error: '',\n      success: false,\n      categories: [],\n      subCategoriesMap: {}\n    };\n  },\n  created() {\n    this.fetchCategories();\n  },\n  methods: {\n    async fetchCategories() {\n      try {\n        const response = await this.$axios.get('http://localhost:8081/api/categories/active');\n        this.categories = response.data.data || [];\n        this.loading = false;\n      } catch (err) {\n        this.error = '获取分类信息失败';\n        this.loading = false;\n        console.error(err);\n      }\n    },\n    async loadSubCategories(categoryId, index) {\n      if (!categoryId) {\n        this.products[index].subCategory = null;\n        return;\n      }\n      try {\n        // 如果已经加载过该分类的子分类，则直接使用\n        if (!this.subCategoriesMap[categoryId]) {\n          const response = await this.$axios.get(`http://localhost:8081/api/sub-categories/category/${categoryId}`);\n          this.subCategoriesMap[categoryId] = Array.isArray(response.data) ? response.data : [];\n        }\n\n        // 清除当前选择的子分类\n        this.products[index].subCategory = null;\n      } catch (err) {\n        console.error('获取子分类信息失败', err);\n      }\n    },\n    onCategoryChange(index) {\n      this.loadSubCategories(this.products[index].categoryId, index);\n    },\n    getSubCategories(index) {\n      const categoryId = this.products[index].categoryId;\n      return categoryId ? this.subCategoriesMap[categoryId] || [] : [];\n    },\n    addRow() {\n      const lastIndex = this.products.length - 1;\n      const lastProduct = this.products[lastIndex];\n\n      // 创建新行，除第一行外，默认继承上一行的分类选择\n      const newRow = {\n        name: '',\n        categoryId: lastProduct.categoryId,\n        subCategory: lastProduct.subCategory,\n        price: 0,\n        theme: '',\n        description: ''\n      };\n      this.products.push(newRow);\n\n      // 如果有分类ID，确保子分类也被加载\n      if (lastProduct.categoryId && !this.subCategoriesMap[lastProduct.categoryId]) {\n        this.loadSubCategories(lastProduct.categoryId, this.products.length - 1);\n      }\n    },\n    removeRow() {\n      if (this.products.length > 1) {\n        this.products.pop();\n      }\n    },\n    async batchPublish() {\n      // 验证所有必填字段\n      for (let i = 0; i < this.products.length; i++) {\n        const product = this.products[i];\n        if (!product.name || !product.categoryId || !product.subCategory || !product.price) {\n          this.error = `第 ${i + 1} 行商品信息不完整，请检查`;\n          return;\n        }\n      }\n      this.error = '';\n      this.loading = true;\n      try {\n        // 逐个发布商品\n        const publishPromises = this.products.map(product => {\n          // 构建商品对象，移除categoryId，只保留subCategory\n          const productData = {\n            name: product.name,\n            subCategory: product.subCategory,\n            price: product.price,\n            description: product.description,\n            theme: product.theme\n          };\n          return this.$axios.post('http://localhost:8081/api/products', productData);\n        });\n        await Promise.all(publishPromises);\n        this.success = true;\n\n        // 发布成功后重置表单\n        setTimeout(() => {\n          this.$router.push('/seller/dashboard');\n        }, 1500);\n      } catch (err) {\n        this.error = '批量发布失败，请重试';\n        console.error(err);\n      } finally {\n        this.loading = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["name","components","data","products","categoryId","subCategory","price","theme","description","loading","error","success","categories","subCategoriesMap","created","fetchCategories","methods","response","$axios","get","err","console","loadSubCategories","index","Array","isArray","onCategoryChange","getSubCategories","addRow","lastIndex","length","lastProduct","newRow","push","removeRow","pop","batchPublish","i","product","publishPromises","map","productData","post","Promise","all","setTimeout","$router"],"sources":["F:\\作业\\Software-Engineering2.0\\litemall\\simple-shop-frontend\\frontend\\src\\views\\ProductBatchForm.vue"],"sourcesContent":["<template>\n  <div class=\"product-batch-form\">\n    <h1>批量发布商品</h1>\n    \n    <div v-if=\"loading\" class=\"loading\">加载中...</div>\n    \n    <div v-if=\"error\" class=\"alert alert-danger\">\n      {{ error }}\n    </div>\n    \n    <div v-if=\"success\" class=\"alert alert-success\">\n      商品批量发布成功！\n    </div>\n    \n    <div v-if=\"!loading\" class=\"card\">\n      <div class=\"table-responsive\">\n        <table class=\"batch-table\">\n          <thead>\n            <tr>\n              <th style=\"width: 5%\">序号</th>\n              <th style=\"width: 15%\">商品名称</th>\n              <th style=\"width: 15%\">商品分类</th>\n              <th style=\"width: 15%\">商品子分类</th>\n              <th style=\"width: 10%\">商品价格</th>\n              <th style=\"width: 10%\">商品主题</th>\n              <th style=\"width: 25%\">商品详情</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr v-for=\"(item, index) in products\" :key=\"index\">\n              <td>{{ index + 1 }}</td>\n              <td>\n                <input type=\"text\" v-model=\"item.name\" required placeholder=\"请输入商品名称\">\n              </td>\n              <td>\n                <select v-model=\"item.categoryId\" @change=\"onCategoryChange(index)\" required>\n                  <option value=\"\">请选择分类</option>\n                  <option v-for=\"category in categories\" :key=\"category.id\" :value=\"category.id\">\n                    {{ category.name }}\n                  </option>\n                </select>\n              </td>\n              <td>\n                <select v-model=\"item.subCategory\" required>\n                  <option value=\"\">请选择子分类</option>\n                  <option v-for=\"subCategory in getSubCategories(index)\" :key=\"subCategory.id\" :value=\"subCategory\">\n                    {{ subCategory.name }}\n                  </option>\n                </select>\n              </td>\n              <td>\n                <input type=\"number\" v-model=\"item.price\" min=\"0\" step=\"0.01\" required placeholder=\"0.00\">\n              </td>\n              <td>\n                <input type=\"text\" v-model=\"item.theme\" placeholder=\"非必填\">\n              </td>\n              <td>\n                <textarea v-model=\"item.description\" placeholder=\"请输入商品详情\"></textarea>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"table-controls\">\n        <button @click=\"addRow\" class=\"btn btn-primary\">+ 添加一行</button>\n        <button @click=\"removeRow\" class=\"btn btn-secondary\" :disabled=\"products.length <= 1\">- 删除最后一行</button>\n      </div>\n      \n      <div class=\"form-actions\">\n        <button @click=\"batchPublish\" class=\"btn btn-primary\">批量发布</button>\n        <a href=\"/seller/product/new\" class=\"btn btn-secondary\">返回</a>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'ProductBatchForm',\n  components: {\n  },\n  data() {\n    return {\n      products: [\n        {\n          name: '',\n          categoryId: null,\n          subCategory: null,\n          price: 0,\n          theme: '',\n          description: ''\n        }\n      ],\n      loading: true,\n      error: '',\n      success: false,\n      categories: [],\n      subCategoriesMap: {}\n    }\n  },\n  created() {\n    this.fetchCategories()\n  },\n  methods: {\n    async fetchCategories() {\n      try {\n        const response = await this.$axios.get('http://localhost:8081/api/categories/active')\n        this.categories = response.data.data || []\n        this.loading = false\n      } catch (err) {\n        this.error = '获取分类信息失败'\n        this.loading = false\n        console.error(err)\n      }\n    },\n    \n    async loadSubCategories(categoryId, index) {\n      if (!categoryId) {\n        this.products[index].subCategory = null\n        return\n      }\n      \n      try {\n        // 如果已经加载过该分类的子分类，则直接使用\n        if (!this.subCategoriesMap[categoryId]) {\n          const response = await this.$axios.get(`http://localhost:8081/api/sub-categories/category/${categoryId}`)\n          this.subCategoriesMap[categoryId] = Array.isArray(response.data) ? response.data : []\n        }\n        \n        // 清除当前选择的子分类\n        this.products[index].subCategory = null\n      } catch (err) {\n        console.error('获取子分类信息失败', err)\n      }\n    },\n    \n    onCategoryChange(index) {\n      this.loadSubCategories(this.products[index].categoryId, index)\n    },\n    \n    getSubCategories(index) {\n      const categoryId = this.products[index].categoryId\n      return categoryId ? this.subCategoriesMap[categoryId] || [] : []\n    },\n    \n    addRow() {\n      const lastIndex = this.products.length - 1\n      const lastProduct = this.products[lastIndex]\n      \n      // 创建新行，除第一行外，默认继承上一行的分类选择\n      const newRow = {\n        name: '',\n        categoryId: lastProduct.categoryId,\n        subCategory: lastProduct.subCategory,\n        price: 0,\n        theme: '',\n        description: ''\n      }\n      \n      this.products.push(newRow)\n      \n      // 如果有分类ID，确保子分类也被加载\n      if (lastProduct.categoryId && !this.subCategoriesMap[lastProduct.categoryId]) {\n        this.loadSubCategories(lastProduct.categoryId, this.products.length - 1)\n      }\n    },\n    \n    removeRow() {\n      if (this.products.length > 1) {\n        this.products.pop()\n      }\n    },\n    \n    async batchPublish() {\n      // 验证所有必填字段\n      for (let i = 0; i < this.products.length; i++) {\n        const product = this.products[i]\n        if (!product.name || !product.categoryId || !product.subCategory || !product.price) {\n          this.error = `第 ${i + 1} 行商品信息不完整，请检查`\n          return\n        }\n      }\n      \n      this.error = ''\n      this.loading = true\n      \n      try {\n        // 逐个发布商品\n        const publishPromises = this.products.map(product => {\n          // 构建商品对象，移除categoryId，只保留subCategory\n          const productData = {\n            name: product.name,\n            subCategory: product.subCategory,\n            price: product.price,\n            description: product.description,\n            theme: product.theme\n          }\n          return this.$axios.post('http://localhost:8081/api/products', productData)\n        })\n        \n        await Promise.all(publishPromises)\n        this.success = true\n        \n        // 发布成功后重置表单\n        setTimeout(() => {\n          this.$router.push('/seller/dashboard')\n        }, 1500)\n      } catch (err) {\n        this.error = '批量发布失败，请重试'\n        console.error(err)\n      } finally {\n        this.loading = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.product-batch-form {\n  max-width: 100%;\n  margin: 0 auto;\n}\n\n.table-responsive {\n  overflow-x: auto;\n  margin-bottom: 1.5rem;\n}\n\n.batch-table {\n  width: 100%;\n  border-collapse: collapse;\n}\n\n.batch-table th,\n.batch-table td {\n  padding: 0.75rem;\n  text-align: left;\n  border-bottom: 1px solid #ddd;\n}\n\n.batch-table th {\n  background-color: #f5f5f5;\n  font-weight: 600;\n}\n\n.batch-table input,\n.batch-table select,\n.batch-table textarea {\n  width: 100%;\n  padding: 0.5rem;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  font-size: 0.875rem;\n}\n\n.batch-table textarea {\n  min-height: 60px;\n  resize: vertical;\n}\n\n.table-controls {\n  display: flex;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n\n.form-actions {\n  display: flex;\n  gap: 1rem;\n  justify-content: flex-end;\n}\n\n.loading {\n  text-align: center;\n  padding: 2rem;\n  font-size: 1.2rem;\n}\n\n.alert {\n  padding: 1rem;\n  margin-bottom: 1.5rem;\n  border-radius: 4px;\n}\n\n.alert-danger {\n  background-color: #f8d7da;\n  color: #721c24;\n  border: 1px solid #f5c6cb;\n}\n\n.alert-success {\n  background-color: #d4edda;\n  color: #155724;\n  border: 1px solid #c3e6cb;\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n  .table-controls {\n    flex-direction: column;\n  }\n  \n  .form-actions {\n    flex-direction: column;\n  }\n  \n  .batch-table {\n    font-size: 0.875rem;\n  }\n  \n  .batch-table th,\n  .batch-table td {\n    padding: 0.5rem;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}