{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nexport default {\n  name: 'RichTextEditor',\n  props: {\n    modelValue: {\n      type: String,\n      default: ''\n    },\n    label: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    // 允许父组件传入自定义的API路径列表\n    customApiPaths: {\n      type: Array,\n      default: () => []\n    }\n  },\n  data() {\n    return {\n      showConfigDialog: false,\n      customUploadPath: ''\n    };\n  },\n  mounted() {\n    // 初始化编辑器内容，添加空值检查\n    if (this.modelValue && this.$refs && this.$refs.editorRef) {\n      this.$refs.editorRef.innerHTML = this.modelValue;\n    }\n  },\n  watch: {\n    modelValue: {\n      handler(newVal) {\n        // 确保editorRef已初始化，添加更严格的空值检查\n        if (this.$refs && this.$refs.editorRef && newVal !== this.$refs.editorRef.innerHTML) {\n          // 只有当外部传入的值与编辑器当前内容不同时才更新\n          // 避免编辑器内部修改导致的循环更新\n          this.$refs.editorRef.innerHTML = newVal;\n        }\n      },\n      immediate: true\n    }\n  },\n  methods: {\n    // 获取当前使用的API路径列表\n    getCurrentApiPaths() {\n      const defaultPaths = ['/api/files/upload/images', '/files/upload/images', '/admin/upload/image', '/api/upload/image', '/upload/image', '/admin/files/upload', '/api/product/upload', '/product/upload', '/upload'];\n      const userCustomPaths = JSON.parse(localStorage.getItem('richTextEditorCustomPaths') || '[]');\n      return [...new Set([...userCustomPaths, ...this.customApiPaths, ...defaultPaths])];\n    },\n    // 检查是否为自定义路径\n    isCustomPath(path) {\n      const defaultPaths = ['/api/files/upload/images', '/files/upload/images', '/admin/upload/image', '/api/upload/image', '/upload/image', '/admin/files/upload', '/api/product/upload', '/product/upload', '/upload'];\n      return !defaultPaths.includes(path) && !this.customApiPaths.includes(path);\n    },\n    // 显示上传配置对话框\n    showUploadConfig() {\n      this.showConfigDialog = true;\n    },\n    // 关闭配置对话框\n    closeConfigDialog() {\n      this.showConfigDialog = false;\n      this.customUploadPath = '';\n    },\n    // 添加自定义路径\n    addCustomPath() {\n      const path = this.customUploadPath.trim();\n      if (!path) {\n        alert('请输入有效的路径');\n        return;\n      }\n\n      // 检查是否是本地文件系统路径\n      if (path.includes('\\\\') || path.startsWith('C:') || path.startsWith('D:') || path.startsWith('E:')) {\n        alert('不能使用本地文件系统路径！请输入API路径，例如：/api/upload/images 或 http://your-server/upload');\n        return;\n      }\n      let customPaths = JSON.parse(localStorage.getItem('richTextEditorCustomPaths') || '[]');\n      if (!customPaths.includes(path)) {\n        customPaths.push(path);\n        localStorage.setItem('richTextEditorCustomPaths', JSON.stringify(customPaths));\n        alert('路径添加成功！');\n        this.customUploadPath = '';\n      } else {\n        alert('该路径已存在');\n      }\n    },\n    // 删除自定义路径\n    removeCustomPath(index) {\n      const currentPaths = this.getCurrentApiPaths();\n      const pathToRemove = currentPaths[index];\n      let customPaths = JSON.parse(localStorage.getItem('richTextEditorCustomPaths') || '[]');\n      customPaths = customPaths.filter(path => path !== pathToRemove);\n      localStorage.setItem('richTextEditorCustomPaths', JSON.stringify(customPaths));\n    },\n    // 重置为默认路径\n    resetPaths() {\n      if (confirm('确定要重置为默认路径吗？这将清除所有自定义路径。')) {\n        localStorage.removeItem('richTextEditorCustomPaths');\n        alert('已重置为默认路径');\n      }\n    },\n    // 处理输入事件，直接发送内容而不重新渲染\n    onInput() {\n      const content = this.$refs.editorRef.innerHTML;\n      this.$emit('update:modelValue', content);\n    },\n    // 处理粘贴事件\n    onPaste(event) {\n      // 阻止默认粘贴行为\n      event.preventDefault();\n\n      // 获取粘贴的文本\n      const text = (event.clipboardData || window.clipboardData).getData('text/plain');\n\n      // 使用document.execCommand插入文本，保持光标位置\n      document.execCommand('insertText', false, text);\n\n      // 触发输入事件更新值\n      this.onInput();\n    },\n    // 文本格式化\n    formatText(command) {\n      try {\n        document.execCommand(command, false, null);\n        this.$refs.editorRef.focus();\n        this.onInput();\n      } catch (error) {\n        console.error('格式化文本失败:', error);\n      }\n    },\n    // 触发图片上传\n    triggerImageUpload() {\n      this.$refs.fileInput.click();\n    },\n    // 处理图片上传\n    uploadImage(event) {\n      // 添加事件目标检查\n      if (!event || !event.target) {\n        console.error('上传事件无效');\n        return;\n      }\n      const file = event.target.files[0];\n      if (!file) return;\n\n      // 检查文件类型\n      const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\n      if (!validTypes.includes(file.type)) {\n        alert('请上传有效的图片文件（JPG、PNG、GIF、WebP）');\n        if (event.target) {\n          event.target.value = '';\n        }\n        return;\n      }\n\n      // 检查文件大小（限制为5MB）\n      if (file.size > 5 * 1024 * 1024) {\n        alert('图片大小不能超过5MB');\n        if (event.target) {\n          event.target.value = '';\n        }\n        return;\n      }\n      console.log('开始上传图片:', file.name);\n      const formData = new FormData();\n      formData.append('files', file);\n\n      // 尝试获取认证token，如果有的话\n      const token = localStorage.getItem('token') || sessionStorage.getItem('token');\n\n      // 配置请求头部\n      const headers = {};\n      if (token) {\n        headers['Authorization'] = `Bearer ${token}`;\n      }\n\n      // 获取所有可用的API路径，并过滤掉本地文件系统路径\n      const apiPaths = this.getCurrentApiPaths().filter(path => !path.includes('\\\\') && !path.startsWith('C:') && !path.startsWith('D:') && !path.startsWith('E:'));\n      console.log('可用的上传路径列表:', apiPaths);\n\n      // 定义递归上传函数\n      const tryUpload = pathIndex => {\n        if (pathIndex >= apiPaths.length) {\n          throw new Error('所有API路径尝试均失败，请检查服务器配置');\n        }\n        const currentPath = apiPaths[pathIndex];\n        console.log(`尝试上传图片，目标URL: ${currentPath}, 尝试次数: ${pathIndex + 1}`);\n        console.log('认证token是否存在:', !!token);\n        return fetch(currentPath, {\n          method: 'POST',\n          body: formData,\n          credentials: 'include',\n          // 确保发送cookies\n          headers: headers\n        }).then(response => {\n          console.log(`路径 ${currentPath} 响应状态:`, response.status);\n          console.log('响应内容类型:', response.headers.get('content-type'));\n\n          // 如果是404错误，尝试下一个路径\n          if (response.status === 404) {\n            console.log(`路径 ${currentPath} 返回404，尝试下一个路径`);\n            return tryUpload(pathIndex + 1);\n          }\n\n          // 检查其他错误状态码\n          if (!response.ok) {\n            throw new Error(`请求失败，状态码: ${response.status}`);\n          }\n\n          // 获取原始响应文本\n          return response.text().then(text => {\n            console.log('原始响应内容:', text.substring(0, 100) + '...');\n\n            // 检查是否包含HTML标签\n            if (text.includes('<!DOCTYPE') || text.includes('<html') || text.includes('<head')) {\n              console.error('检测到HTML响应，尝试下一个API路径');\n              return tryUpload(pathIndex + 1);\n            }\n\n            // 尝试解析JSON\n            try {\n              return JSON.parse(text);\n            } catch (e) {\n              // 如果解析失败，尝试下一个路径\n              console.error(`路径 ${currentPath} 返回非JSON响应，尝试下一个路径`);\n              return tryUpload(pathIndex + 1);\n            }\n          });\n        });\n      };\n\n      // 开始尝试上传，从第一个API路径开始\n      tryUpload(0).then(data => {\n        console.log('上传响应数据格式:', Object.keys(data));\n        // 检查各种可能的响应格式\n        if (data && data.imageUrls && data.imageUrls.length > 0) {\n          this.insertImageAtCursor(data.imageUrls[0]);\n        } else if (data && data.url) {\n          this.insertImageAtCursor(data.url);\n        } else if (data && data.data && data.data.imageUrls && data.data.imageUrls.length > 0) {\n          this.insertImageAtCursor(data.data.imageUrls[0]);\n        } else {\n          console.error('未预期的响应格式:', data);\n          alert('上传失败: 服务器返回格式不正确');\n        }\n      }).catch(error => {\n        console.error('图片上传错误:', error);\n        // 更友好的错误提示\n        if (error.message.includes('Failed to fetch')) {\n          alert('上传失败: 无法连接到服务器。请确保API路径正确，并且服务器正在运行。本地文件系统路径不能用于上传！');\n        } else if (error.message.includes('HTML')) {\n          alert('上传失败: 服务器返回HTML内容而非JSON，可能API路径不正确或服务器未正确配置');\n        } else if (error.message.includes('Unexpected token')) {\n          alert('上传失败: 服务器返回的内容不是有效的JSON格式');\n        } else if (error.message.includes('所有API路径尝试均失败')) {\n          alert('上传失败: 无法连接到正确的图片上传API，请联系管理员或配置有效的API上传路径');\n        } else {\n          alert('上传失败: ' + error.message);\n        }\n      }).finally(() => {\n        // 清空文件输入，添加安全检查\n        if (event && event.target) {\n          event.target.value = '';\n        }\n      });\n    },\n    // 在光标位置插入图片\n    insertImageAtCursor(imageUrl) {\n      try {\n        // 添加更严格的空值检查\n        if (!this.$refs || !this.$refs.editorRef) {\n          console.error('编辑器引用未初始化');\n          alert('编辑器未准备就绪，请稍后再试');\n          return;\n        }\n        const selection = window.getSelection();\n        if (!selection || selection.rangeCount === 0) {\n          // 如果没有选中区域，直接在末尾添加\n          const img = document.createElement('img');\n          img.src = imageUrl;\n          img.style.maxWidth = '100%';\n          this.$refs.editorRef.appendChild(img);\n        } else {\n          // 获取当前选中区域\n          const range = selection.getRangeAt(0);\n\n          // 创建图片元素\n          const img = document.createElement('img');\n          img.src = imageUrl;\n          img.style.maxWidth = '100%';\n\n          // 在光标位置插入图片\n          range.deleteContents();\n          range.insertNode(img);\n\n          // 将光标移动到图片后面\n          range.setStartAfter(img);\n          range.setEndAfter(img);\n          selection.removeAllRanges();\n          selection.addRange(range);\n        }\n\n        // 更新内容并保持焦点\n        this.onInput();\n        if (this.$refs && this.$refs.editorRef) {\n          this.$refs.editorRef.focus();\n        }\n      } catch (error) {\n        console.error('插入图片失败:', error);\n        alert('插入图片失败，请重试');\n      }\n    },\n    // 获取编辑器内容\n    getContent() {\n      if (!this.$refs || !this.$refs.editorRef) {\n        console.error('编辑器引用未初始化，无法获取内容');\n        return '';\n      }\n      return this.$refs.editorRef.innerHTML;\n    },\n    // 设置编辑器内容\n    setContent(content) {\n      if (!this.$refs || !this.$refs.editorRef) {\n        console.error('编辑器引用未初始化，无法设置内容');\n        return;\n      }\n      this.$refs.editorRef.innerHTML = content;\n      this.$emit('update:modelValue', content);\n    },\n    // 清空编辑器\n    clear() {\n      if (!this.$refs || !this.$refs.editorRef) {\n        console.error('编辑器引用未初始化，无法清空内容');\n        return;\n      }\n      this.$refs.editorRef.innerHTML = '';\n      this.$emit('update:modelValue', '');\n    }\n  }\n};","map":{"version":3,"names":["name","props","modelValue","type","String","default","label","disabled","Boolean","customApiPaths","Array","data","showConfigDialog","customUploadPath","mounted","$refs","editorRef","innerHTML","watch","handler","newVal","immediate","methods","getCurrentApiPaths","defaultPaths","userCustomPaths","JSON","parse","localStorage","getItem","Set","isCustomPath","path","includes","showUploadConfig","closeConfigDialog","addCustomPath","trim","alert","startsWith","customPaths","push","setItem","stringify","removeCustomPath","index","currentPaths","pathToRemove","filter","resetPaths","confirm","removeItem","onInput","content","$emit","onPaste","event","preventDefault","text","clipboardData","window","getData","document","execCommand","formatText","command","focus","error","console","triggerImageUpload","fileInput","click","uploadImage","target","file","files","validTypes","value","size","log","formData","FormData","append","token","sessionStorage","headers","apiPaths","tryUpload","pathIndex","length","Error","currentPath","fetch","method","body","credentials","then","response","status","get","ok","substring","e","Object","keys","imageUrls","insertImageAtCursor","url","catch","message","finally","imageUrl","selection","getSelection","rangeCount","img","createElement","src","style","maxWidth","appendChild","range","getRangeAt","deleteContents","insertNode","setStartAfter","setEndAfter","removeAllRanges","addRange","getContent","setContent","clear"],"sources":["D:\\github\\最后一舞\\simple-shop-frontend\\frontend\\src\\components\\RichTextEditor.vue"],"sourcesContent":["<template>\r\n  <div class=\"editor-container\">\r\n    <label v-if=\"label\" class=\"editor-label\">{{ label }}</label>\r\n    <div ref=\"editorRef\" class=\"rich-text-editor\"\r\n         :contenteditable=\"!disabled\"\r\n         @input=\"onInput\"\r\n         @paste=\"onPaste\"></div>\r\n    <div class=\"toolbar\" v-if=\"!disabled\">\r\n      <button type=\"button\" @click=\"formatText('bold')\" title=\"粗体\">粗体</button>\r\n      <button type=\"button\" @click=\"formatText('italic')\" title=\"斜体\">斜体</button>\r\n      <button type=\"button\" @click=\"formatText('underline')\" title=\"下划线\">下划线</button>\r\n      <button type=\"button\" @click=\"triggerImageUpload\" title=\"插入图片\">插入图片</button>\r\n      <button type=\"button\" @click=\"showUploadConfig\" title=\"配置上传路径\">配置上传</button>\r\n      <input ref=\"fileInput\" type=\"file\" accept=\"image/*\" style=\"display: none\" @change=\"uploadImage\">\r\n    </div>\r\n    \r\n    <!-- 上传路径配置对话框 -->\r\n    <div v-if=\"showConfigDialog\" class=\"config-dialog-overlay\" @click=\"closeConfigDialog\">\r\n      <div class=\"config-dialog\" @click.stop>\r\n        <h3>配置图片上传路径</h3>\r\n        <div class=\"config-item\">\r\n          <label>自定义上传路径：</label>\r\n          <input type=\"text\" v-model=\"customUploadPath\" placeholder=\"例如：/api/custom/upload\">\r\n          <button @click=\"addCustomPath\">添加</button>\r\n        </div>\r\n        <div class=\"config-item\">\r\n          <label>当前使用的路径列表：</label>\r\n          <div class=\"path-list\">\r\n            <div v-for=\"(path, index) in getCurrentApiPaths()\" :key=\"index\" class=\"path-item\">\r\n              {{ path }}\r\n              <button v-if=\"isCustomPath(path)\" @click=\"removeCustomPath(index)\" class=\"remove-btn\">删除</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"dialog-buttons\">\r\n          <button @click=\"resetPaths\">重置为默认路径</button>\r\n          <button @click=\"closeConfigDialog\" class=\"confirm-btn\">确定</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'RichTextEditor',\r\n  props: {\r\n    modelValue: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    label: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    // 允许父组件传入自定义的API路径列表\r\n    customApiPaths: {\r\n      type: Array,\r\n      default: () => []\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      showConfigDialog: false,\r\n      customUploadPath: ''\r\n    }\r\n  },\r\n  mounted() {\r\n    // 初始化编辑器内容，添加空值检查\r\n    if (this.modelValue && this.$refs && this.$refs.editorRef) {\r\n      this.$refs.editorRef.innerHTML = this.modelValue\r\n    }\r\n  },\r\n  watch: {\r\n    modelValue: {\r\n      handler(newVal) {\r\n        // 确保editorRef已初始化，添加更严格的空值检查\r\n        if (this.$refs && this.$refs.editorRef && newVal !== this.$refs.editorRef.innerHTML) {\r\n          // 只有当外部传入的值与编辑器当前内容不同时才更新\r\n          // 避免编辑器内部修改导致的循环更新\r\n          this.$refs.editorRef.innerHTML = newVal\r\n        }\r\n      },\r\n      immediate: true\r\n    }\r\n  },\r\n  methods: {\r\n    // 获取当前使用的API路径列表\r\n    getCurrentApiPaths() {\r\n      const defaultPaths = [\r\n        '/api/files/upload/images', \r\n        '/files/upload/images', \r\n        '/admin/upload/image',\r\n        '/api/upload/image',\r\n        '/upload/image',\r\n        '/admin/files/upload',\r\n        '/api/product/upload',\r\n        '/product/upload',\r\n        '/upload'\r\n      ]\r\n      const userCustomPaths = JSON.parse(localStorage.getItem('richTextEditorCustomPaths') || '[]')\r\n      return [...new Set([...userCustomPaths, ...this.customApiPaths, ...defaultPaths])]\r\n    },\r\n    \r\n    // 检查是否为自定义路径\r\n    isCustomPath(path) {\r\n      const defaultPaths = [\r\n        '/api/files/upload/images', \r\n        '/files/upload/images', \r\n        '/admin/upload/image',\r\n        '/api/upload/image',\r\n        '/upload/image',\r\n        '/admin/files/upload',\r\n        '/api/product/upload',\r\n        '/product/upload',\r\n        '/upload'\r\n      ]\r\n      return !defaultPaths.includes(path) && !this.customApiPaths.includes(path)\r\n    },\r\n    \r\n    // 显示上传配置对话框\r\n    showUploadConfig() {\r\n      this.showConfigDialog = true\r\n    },\r\n    \r\n    // 关闭配置对话框\r\n    closeConfigDialog() {\r\n      this.showConfigDialog = false\r\n      this.customUploadPath = ''\r\n    },\r\n    \r\n    // 添加自定义路径\r\n    addCustomPath() {\r\n      const path = this.customUploadPath.trim()\r\n      if (!path) {\r\n        alert('请输入有效的路径')\r\n        return\r\n      }\r\n      \r\n      // 检查是否是本地文件系统路径\r\n      if (path.includes('\\\\') || path.startsWith('C:') || path.startsWith('D:') || path.startsWith('E:')) {\r\n        alert('不能使用本地文件系统路径！请输入API路径，例如：/api/upload/images 或 http://your-server/upload')\r\n        return\r\n      }\r\n      \r\n      let customPaths = JSON.parse(localStorage.getItem('richTextEditorCustomPaths') || '[]')\r\n      if (!customPaths.includes(path)) {\r\n        customPaths.push(path)\r\n        localStorage.setItem('richTextEditorCustomPaths', JSON.stringify(customPaths))\r\n        alert('路径添加成功！')\r\n        this.customUploadPath = ''\r\n      } else {\r\n        alert('该路径已存在')\r\n      }\r\n    },\r\n    \r\n    // 删除自定义路径\r\n    removeCustomPath(index) {\r\n      const currentPaths = this.getCurrentApiPaths()\r\n      const pathToRemove = currentPaths[index]\r\n      \r\n      let customPaths = JSON.parse(localStorage.getItem('richTextEditorCustomPaths') || '[]')\r\n      customPaths = customPaths.filter(path => path !== pathToRemove)\r\n      localStorage.setItem('richTextEditorCustomPaths', JSON.stringify(customPaths))\r\n    },\r\n    \r\n    // 重置为默认路径\r\n    resetPaths() {\r\n      if (confirm('确定要重置为默认路径吗？这将清除所有自定义路径。')) {\r\n        localStorage.removeItem('richTextEditorCustomPaths')\r\n        alert('已重置为默认路径')\r\n      }\r\n    },\r\n    \r\n    // 处理输入事件，直接发送内容而不重新渲染\r\n    onInput() {\r\n      const content = this.$refs.editorRef.innerHTML\r\n      this.$emit('update:modelValue', content)\r\n    },\r\n    \r\n    // 处理粘贴事件\r\n    onPaste(event) {\r\n      // 阻止默认粘贴行为\r\n      event.preventDefault()\r\n      \r\n      // 获取粘贴的文本\r\n      const text = (event.clipboardData || window.clipboardData).getData('text/plain')\r\n      \r\n      // 使用document.execCommand插入文本，保持光标位置\r\n      document.execCommand('insertText', false, text)\r\n      \r\n      // 触发输入事件更新值\r\n      this.onInput()\r\n    },\r\n    \r\n    // 文本格式化\r\n    formatText(command) {\r\n      try {\r\n        document.execCommand(command, false, null)\r\n        this.$refs.editorRef.focus()\r\n        this.onInput()\r\n      } catch (error) {\r\n        console.error('格式化文本失败:', error)\r\n      }\r\n    },\r\n    \r\n    // 触发图片上传\r\n    triggerImageUpload() {\r\n      this.$refs.fileInput.click()\r\n    },\r\n    \r\n    // 处理图片上传\r\n    uploadImage(event) {\r\n      // 添加事件目标检查\r\n      if (!event || !event.target) {\r\n        console.error('上传事件无效')\r\n        return\r\n      }\r\n      \r\n      const file = event.target.files[0]\r\n      if (!file) return\r\n      \r\n      // 检查文件类型\r\n      const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp']\r\n      if (!validTypes.includes(file.type)) {\r\n        alert('请上传有效的图片文件（JPG、PNG、GIF、WebP）')\r\n        if (event.target) {\r\n          event.target.value = ''\r\n        }\r\n        return\r\n      }\r\n      \r\n      // 检查文件大小（限制为5MB）\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        alert('图片大小不能超过5MB')\r\n        if (event.target) {\r\n          event.target.value = ''\r\n        }\r\n        return\r\n      }\r\n      \r\n      console.log('开始上传图片:', file.name)\r\n      \r\n      const formData = new FormData()\r\n      formData.append('files', file)\r\n      \r\n      // 尝试获取认证token，如果有的话\r\n      const token = localStorage.getItem('token') || sessionStorage.getItem('token')\r\n      \r\n      // 配置请求头部\r\n      const headers = {}\r\n      if (token) {\r\n        headers['Authorization'] = `Bearer ${token}`\r\n      }\r\n      \r\n      // 获取所有可用的API路径，并过滤掉本地文件系统路径\r\n      const apiPaths = this.getCurrentApiPaths().filter(path => \r\n        !path.includes('\\\\') && \r\n        !path.startsWith('C:') && \r\n        !path.startsWith('D:') && \r\n        !path.startsWith('E:')\r\n      )\r\n      \r\n      console.log('可用的上传路径列表:', apiPaths)\r\n      \r\n      // 定义递归上传函数\r\n      const tryUpload = (pathIndex) => {\r\n        if (pathIndex >= apiPaths.length) {\r\n          throw new Error('所有API路径尝试均失败，请检查服务器配置')\r\n        }\r\n        \r\n        const currentPath = apiPaths[pathIndex]\r\n        console.log(`尝试上传图片，目标URL: ${currentPath}, 尝试次数: ${pathIndex + 1}`)\r\n        console.log('认证token是否存在:', !!token)\r\n        \r\n        return fetch(currentPath, {\r\n          method: 'POST',\r\n          body: formData,\r\n          credentials: 'include', // 确保发送cookies\r\n          headers: headers\r\n        })\r\n        .then(response => {\r\n          console.log(`路径 ${currentPath} 响应状态:`, response.status)\r\n          console.log('响应内容类型:', response.headers.get('content-type'))\r\n          \r\n          // 如果是404错误，尝试下一个路径\r\n          if (response.status === 404) {\r\n            console.log(`路径 ${currentPath} 返回404，尝试下一个路径`)\r\n            return tryUpload(pathIndex + 1)\r\n          }\r\n          \r\n          // 检查其他错误状态码\r\n          if (!response.ok) {\r\n            throw new Error(`请求失败，状态码: ${response.status}`)\r\n          }\r\n          \r\n          // 获取原始响应文本\r\n          return response.text().then(text => {\r\n            console.log('原始响应内容:', text.substring(0, 100) + '...')\r\n            \r\n            // 检查是否包含HTML标签\r\n            if (text.includes('<!DOCTYPE') || text.includes('<html') || text.includes('<head')) {\r\n              console.error('检测到HTML响应，尝试下一个API路径')\r\n              return tryUpload(pathIndex + 1)\r\n            }\r\n            \r\n            // 尝试解析JSON\r\n            try {\r\n              return JSON.parse(text)\r\n            } catch (e) {\r\n              // 如果解析失败，尝试下一个路径\r\n              console.error(`路径 ${currentPath} 返回非JSON响应，尝试下一个路径`)\r\n              return tryUpload(pathIndex + 1)\r\n            }\r\n          })\r\n        })\r\n      }\r\n      \r\n      // 开始尝试上传，从第一个API路径开始\r\n      tryUpload(0)\r\n      .then(data => {\r\n        console.log('上传响应数据格式:', Object.keys(data))\r\n        // 检查各种可能的响应格式\r\n        if (data && data.imageUrls && data.imageUrls.length > 0) {\r\n          this.insertImageAtCursor(data.imageUrls[0])\r\n        } else if (data && data.url) {\r\n          this.insertImageAtCursor(data.url)\r\n        } else if (data && data.data && data.data.imageUrls && data.data.imageUrls.length > 0) {\r\n          this.insertImageAtCursor(data.data.imageUrls[0])\r\n        } else {\r\n          console.error('未预期的响应格式:', data)\r\n          alert('上传失败: 服务器返回格式不正确')\r\n        }\r\n      })\r\n      .catch(error => {\r\n        console.error('图片上传错误:', error)\r\n        // 更友好的错误提示\r\n        if (error.message.includes('Failed to fetch')) {\r\n          alert('上传失败: 无法连接到服务器。请确保API路径正确，并且服务器正在运行。本地文件系统路径不能用于上传！')\r\n        } else if (error.message.includes('HTML')) {\r\n          alert('上传失败: 服务器返回HTML内容而非JSON，可能API路径不正确或服务器未正确配置')\r\n        } else if (error.message.includes('Unexpected token')) {\r\n          alert('上传失败: 服务器返回的内容不是有效的JSON格式')\r\n        } else if (error.message.includes('所有API路径尝试均失败')) {\r\n          alert('上传失败: 无法连接到正确的图片上传API，请联系管理员或配置有效的API上传路径')\r\n        } else {\r\n          alert('上传失败: ' + error.message)\r\n        }\r\n      })\r\n      .finally(() => {\r\n        // 清空文件输入，添加安全检查\r\n        if (event && event.target) {\r\n          event.target.value = ''\r\n        }\r\n      })\r\n    },\r\n    \r\n    // 在光标位置插入图片\r\n    insertImageAtCursor(imageUrl) {\r\n      try {\r\n        // 添加更严格的空值检查\r\n        if (!this.$refs || !this.$refs.editorRef) {\r\n          console.error('编辑器引用未初始化')\r\n          alert('编辑器未准备就绪，请稍后再试')\r\n          return\r\n        }\r\n        \r\n        const selection = window.getSelection()\r\n        if (!selection || selection.rangeCount === 0) {\r\n          // 如果没有选中区域，直接在末尾添加\r\n          const img = document.createElement('img')\r\n          img.src = imageUrl\r\n          img.style.maxWidth = '100%'\r\n          this.$refs.editorRef.appendChild(img)\r\n        } else {\r\n          // 获取当前选中区域\r\n          const range = selection.getRangeAt(0)\r\n          \r\n          // 创建图片元素\r\n          const img = document.createElement('img')\r\n          img.src = imageUrl\r\n          img.style.maxWidth = '100%'\r\n          \r\n          // 在光标位置插入图片\r\n          range.deleteContents()\r\n          range.insertNode(img)\r\n          \r\n          // 将光标移动到图片后面\r\n          range.setStartAfter(img)\r\n          range.setEndAfter(img)\r\n          selection.removeAllRanges()\r\n          selection.addRange(range)\r\n        }\r\n        \r\n        // 更新内容并保持焦点\r\n        this.onInput()\r\n        if (this.$refs && this.$refs.editorRef) {\r\n          this.$refs.editorRef.focus()\r\n        }\r\n      } catch (error) {\r\n        console.error('插入图片失败:', error)\r\n        alert('插入图片失败，请重试')\r\n      }\r\n    },\r\n    \r\n    // 获取编辑器内容\r\n    getContent() {\r\n      if (!this.$refs || !this.$refs.editorRef) {\r\n        console.error('编辑器引用未初始化，无法获取内容')\r\n        return ''\r\n      }\r\n      return this.$refs.editorRef.innerHTML\r\n    },\r\n    \r\n    // 设置编辑器内容\r\n    setContent(content) {\r\n      if (!this.$refs || !this.$refs.editorRef) {\r\n        console.error('编辑器引用未初始化，无法设置内容')\r\n        return\r\n      }\r\n      this.$refs.editorRef.innerHTML = content\r\n      this.$emit('update:modelValue', content)\r\n    },\r\n    \r\n    // 清空编辑器\r\n    clear() {\r\n      if (!this.$refs || !this.$refs.editorRef) {\r\n        console.error('编辑器引用未初始化，无法清空内容')\r\n        return\r\n      }\r\n      this.$refs.editorRef.innerHTML = ''\r\n      this.$emit('update:modelValue', '')\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.editor-container {\r\n  width: 100%;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.editor-label {\r\n  display: block;\r\n  margin-bottom: 8px;\r\n  font-weight: bold;\r\n}\r\n\r\n.rich-text-editor {\r\n  border: 1px solid #ddd;\r\n  padding: 10px;\r\n  min-height: 200px;\r\n  outline: none;\r\n  background-color: white;\r\n}\r\n\r\n.toolbar {\r\n  margin-top: 10px;\r\n  display: flex;\r\n  gap: 10px;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.toolbar button {\r\n  padding: 5px 10px;\r\n  background-color: #f0f0f0;\r\n  border: 1px solid #ddd;\r\n  cursor: pointer;\r\n  border-radius: 4px;\r\n}\r\n\r\n.toolbar button:hover {\r\n  background-color: #e0e0e0;\r\n}\r\n\r\n/* 配置对话框样式 */\r\n.config-dialog-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  z-index: 1000;\r\n}\r\n\r\n.config-dialog {\r\n  background-color: white;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n  width: 90%;\r\n  max-width: 500px;\r\n  max-height: 80vh;\r\n  overflow-y: auto;\r\n}\r\n\r\n.config-dialog h3 {\r\n  margin-top: 0;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.config-item {\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.config-item label {\r\n  display: block;\r\n  margin-bottom: 5px;\r\n  font-weight: bold;\r\n}\r\n\r\n.config-item input[type=\"text\"] {\r\n  width: calc(100% - 80px);\r\n  padding: 8px;\r\n  margin-right: 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n}\r\n\r\n.config-item button {\r\n  padding: 8px 12px;\r\n  background-color: #4CAF50;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n}\r\n\r\n.config-item button:hover {\r\n  background-color: #45a049;\r\n}\r\n\r\n.path-list {\r\n  max-height: 200px;\r\n  overflow-y: auto;\r\n  border: 1px solid #ddd;\r\n  padding: 10px;\r\n  border-radius: 4px;\r\n}\r\n\r\n.path-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 5px 0;\r\n  border-bottom: 1px solid #f0f0f0;\r\n}\r\n\r\n.path-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.remove-btn {\r\n  background-color: #f44336 !important;\r\n  color: white !important;\r\n  padding: 3px 8px !important;\r\n  font-size: 12px;\r\n}\r\n\r\n.remove-btn:hover {\r\n  background-color: #d32f2f !important;\r\n}\r\n\r\n.dialog-buttons {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 10px;\r\n  margin-top: 20px;\r\n}\r\n\r\n.confirm-btn {\r\n  background-color: #2196F3 !important;\r\n}\r\n\r\n.confirm-btn:hover {\r\n  background-color: #1976D2 !important;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}