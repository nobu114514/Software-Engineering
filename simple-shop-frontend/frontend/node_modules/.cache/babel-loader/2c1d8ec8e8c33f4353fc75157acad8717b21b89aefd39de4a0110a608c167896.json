{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n  class: \"product-history\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"alert alert-danger\"\n};\nconst _hoisted_4 = {\n  key: 2,\n  class: \"alert alert-info\"\n};\nconst _hoisted_5 = {\n  key: 3,\n  class: \"product-table\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"status-active\"\n};\nconst _hoisted_7 = {\n  key: 1,\n  class: \"status-inactive\"\n};\nconst _hoisted_8 = {\n  key: 2,\n  class: \"status-frozen\"\n};\nconst _hoisted_9 = [\"href\"];\nconst _hoisted_10 = [\"onClick\", \"disabled\"];\nconst _hoisted_11 = {\n  key: 4,\n  class: \"alert alert-danger\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[1] || (_cache[1] = _createElementVNode(\"h1\", null, \"商品历史记录\", -1 /* CACHED */)), $data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"加载中...\")) : _createCommentVNode(\"v-if\", true), $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, _toDisplayString($data.error), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 提示信息：当前系统只允许一个商品在售 \"), !$data.loading && $data.products.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, \" 系统提示：当前仅允许一个商品处于在售状态，新商品上架时其他商品将自动下架 \")) : _createCommentVNode(\"v-if\", true), !$data.loading && $data.products.length > 0 ? (_openBlock(), _createElementBlock(\"table\", _hoisted_5, [_cache[0] || (_cache[0] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", null, \"ID\"), _createElementVNode(\"th\", null, \"名称\"), _createElementVNode(\"th\", null, \"价格\"), _createElementVNode(\"th\", null, \"状态\"), _createElementVNode(\"th\", null, \"创建时间\"), _createElementVNode(\"th\", null, \"操作\")])], -1 /* CACHED */)), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.products, product => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: product.id\n    }, [_createElementVNode(\"td\", null, _toDisplayString(product.id), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(product.name), 1 /* TEXT */), _createElementVNode(\"td\", null, \"¥\" + _toDisplayString(product.price.toFixed(2)), 1 /* TEXT */), _createElementVNode(\"td\", null, [product.active ? (_openBlock(), _createElementBlock(\"span\", _hoisted_6, \"在售\")) : (_openBlock(), _createElementBlock(\"span\", _hoisted_7, \"已下架\")), product.frozen ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, \" (已冻结)\")) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"td\", null, _toDisplayString($options.formatDate(product.createdAt)), 1 /* TEXT */), _createElementVNode(\"td\", null, [_createCommentVNode(\" 编辑按钮 \"), _createElementVNode(\"a\", {\n      href: '/seller/product/new?id=' + product.id,\n      class: \"btn\"\n    }, \"编辑\", 8 /* PROPS */, _hoisted_9), _createCommentVNode(\" 上架 / 下架 按钮 \"), _createElementVNode(\"button\", {\n      class: _normalizeClass([\"btn\", {\n        'btn-secondary': product.active,\n        'btn-success': !product.active\n      }]),\n      onClick: $event => $options.toggleActive(product),\n      disabled: product.active && $options.getActiveProductsCount() <= 1\n    }, _toDisplayString(product.active ? '下架' : '上架'), 11 /* TEXT, CLASS, PROPS */, _hoisted_10)])]);\n  }), 128 /* KEYED_FRAGMENT */))])])) : _createCommentVNode(\"v-if\", true), !$data.loading && $data.products.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, \" 暂无商品记录 \")) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","$data","loading","_hoisted_2","error","_hoisted_3","_toDisplayString","_createCommentVNode","products","length","_hoisted_4","_hoisted_5","_Fragment","_renderList","product","key","id","name","price","toFixed","active","_hoisted_6","_hoisted_7","frozen","_hoisted_8","$options","formatDate","createdAt","href","_hoisted_9","_normalizeClass","onClick","$event","toggleActive","disabled","getActiveProductsCount","_hoisted_10","_hoisted_11"],"sources":["D:\\game\\Trae\\存档\\Software-Engineering2.0\\Software-Engineering-9bea62c8ef6d7754a2d932a0227f9bc4fff09a3c\\litemall\\simple-shop-frontend\\frontend\\src\\views\\ProductHistory.vue"],"sourcesContent":["<template>\n    <div class=\"product-history\">\n        <h1>商品历史记录</h1>\n\n        <div v-if=\"loading\" class=\"loading\">加载中...</div>\n\n        <div v-if=\"error\" class=\"alert alert-danger\">\n            {{ error }}\n        </div>\n\n        <!-- 提示信息：当前系统只允许一个商品在售 -->\n        <div class=\"alert alert-info\" v-if=\"!loading && products.length > 0\">\n            系统提示：当前仅允许一个商品处于在售状态，新商品上架时其他商品将自动下架\n        </div>\n\n        <table v-if=\"!loading && products.length > 0\" class=\"product-table\">\n            <thead>\n            <tr>\n                <th>ID</th>\n                <th>名称</th>\n                <th>价格</th>\n                <th>状态</th>\n                <th>创建时间</th>\n                <th>操作</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr v-for=\"product in products\" :key=\"product.id\">\n                <td>{{ product.id }}</td>\n                <td>{{ product.name }}</td>\n                <td>¥{{ product.price.toFixed(2) }}</td>\n                <td>\n                    <span v-if=\"product.active\" class=\"status-active\">在售</span>\n                    <span v-else class=\"status-inactive\">已下架</span>\n                    <span v-if=\"product.frozen\" class=\"status-frozen\"> (已冻结)</span>\n                </td>\n                <td>{{ formatDate(product.createdAt) }}</td>\n                <td>\n                    <!-- 编辑按钮 -->\n                    <a :href=\"'/seller/product/new?id=' + product.id\" class=\"btn\">编辑</a>\n\n                    <!-- 上架 / 下架 按钮 -->\n                    <button\n                            class=\"btn\"\n                            :class=\"{ 'btn-secondary': product.active, 'btn-success': !product.active }\"\n                            @click=\"toggleActive(product)\"\n                            :disabled=\"product.active && getActiveProductsCount() <= 1\">\n                        {{ product.active ? '下架' : '上架' }}\n                    </button>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div v-if=\"!loading && products.length === 0\" class=\"alert alert-danger\">\n            暂无商品记录\n        </div>\n    </div>\n</template>\n\n<script>\n    export default {\n      name: 'ProductHistory',\n      data() {\n        return {\n          products: [],\n          loading: true,\n          error: ''\n        }\n      },\n      created() {\n        this.fetchProducts()\n      },\n      methods: {\n        async fetchProducts() {\n          try {\n            this.loading = true\n            const response = await this.$axios.get('/products') // 实际请求：http://localhost:8081/api/products\n            this.products = response.data\n            this.error = ''\n          } catch (err) {\n            this.error = '获取商品列表失败'\n            console.error(err)\n          } finally {\n            this.loading = false\n          }\n        },\n\n        // 获取当前在售商品数量\n        getActiveProductsCount() {\n          return this.products.filter(p => p.isActive).length\n        },\n\n        async toggleActive(product) {\n          try {\n            if (product.isActive) {\n              // 当前是“在售”，执行下架\n              await this.$axios.put(`/products/${product.id}/deactivate`)\n            } else {\n              // 当前是“已下架”，执行上架\n              // 先检查是否有其他在售商品\n              const activeProducts = this.products.filter(p => p.isActive && p.id !== product.id)\n\n              // 先上架当前商品\n              await this.$axios.put(`/products/${product.id}/activate`)\n\n              // 再将其他所有在售商品下架\n              if (activeProducts.length > 0) {\n                // 显示提示信息\n                this.error = `已自动将 ${activeProducts.length} 个商品下架，确保只有一个在售商品`\n\n                // 延迟清除提示信息\n                setTimeout(() => {\n                  this.error = ''\n                }, 3000)\n\n                // 逐个下架其他商品\n                for (const p of activeProducts) {\n                  await this.$axios.put(`/products/${p.id}/deactivate`)\n                }\n              }\n            }\n\n            // 刷新商品列表\n            this.fetchProducts()\n          } catch (err) {\n            this.error = '操作失败，请重试'\n            console.error(err)\n          }\n        },\n\n        formatDate(dateString) {\n          if (!dateString) return ''\n          const date = new Date(dateString)\n          return date.toLocaleString()\n        }\n      }\n    }\n</script>\n\n<style scoped>\n    .loading {\n      text-align: center;\n      padding: 2rem;\n      font-size: 1.2rem;\n    }\n\n    .alert {\n      padding: 1rem;\n      margin: 1rem 0;\n      border-radius: 4px;\n    }\n\n    .alert-danger {\n      background-color: #f8d7da;\n      color: #721c24;\n      border: 1px solid #f5c6cb;\n    }\n\n    .alert-info {\n      background-color: #d1ecf1;\n      color: #0c5460;\n      border: 1px solid #bee5eb;\n    }\n\n    .product-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin-top: 1rem;\n    }\n\n    .product-table th,\n    .product-table td {\n      padding: 0.75rem;\n      text-align: left;\n      border-bottom: 1px solid #ddd;\n    }\n\n    .status-active {\n      color: #28a745;\n      font-weight: bold;\n    }\n\n    .status-inactive {\n      color: #6c757d;\n    }\n\n    .status-frozen {\n      color: #dc3545;\n    }\n\n    .btn {\n      margin-right: 0.5rem;\n      padding: 0.25rem 0.75rem;\n      color: white;\n      text-decoration: none;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    /* 下架按钮 - 灰色 */\n    .btn-secondary {\n      background: #6c757d;\n    }\n\n    /* 上架按钮 - 绿色 */\n    .btn-success {\n      background: #28a745;\n    }\n\n    .btn:disabled {\n      background: #ccc;\n      cursor: not-allowed;\n    }\n</style>\n"],"mappings":";;EACSA,KAAK,EAAC;AAAiB;;;EAGJA,KAAK,EAAC;;;;EAERA,KAAK,EAAC;;;;EAKnBA,KAAK,EAAC;;;;EAImCA,KAAK,EAAC;;;;EAiBZA,KAAK,EAAC;;;;EACrBA,KAAK,EAAC;;;;EACSA,KAAK,EAAC;;;;;;EAoBAA,KAAK,EAAC;;;uBArDxDC,mBAAA,CAwDM,OAxDNC,UAwDM,G,0BAvDFC,mBAAA,CAAe,YAAX,QAAM,qBAECC,KAAA,CAAAC,OAAO,I,cAAlBJ,mBAAA,CAAgD,OAAhDK,UAAgD,EAAZ,QAAM,K,mCAE/BF,KAAA,CAAAG,KAAK,I,cAAhBN,mBAAA,CAEM,OAFNO,UAEM,EAAAC,gBAAA,CADCL,KAAA,CAAAG,KAAK,oB,mCAGZG,mBAAA,wBAA2B,E,CACUN,KAAA,CAAAC,OAAO,IAAID,KAAA,CAAAO,QAAQ,CAACC,MAAM,Q,cAA/DX,mBAAA,CAEM,OAFNY,UAEM,EAF+D,wCAErE,K,oCAEcT,KAAA,CAAAC,OAAO,IAAID,KAAA,CAAAO,QAAQ,CAACC,MAAM,Q,cAAxCX,mBAAA,CAqCQ,SArCRa,UAqCQ,G,0BApCJX,mBAAA,CASQ,gBARRA,mBAAA,CAOK,aANDA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAa,YAAT,MAAI,GACRA,mBAAA,CAAW,YAAP,IAAE,E,uBAGVA,mBAAA,CAyBQ,iB,kBAxBRF,mBAAA,CAuBKc,SAAA,QAAAC,WAAA,CAvBiBZ,KAAA,CAAAO,QAAQ,EAAnBM,OAAO;yBAAlBhB,mBAAA,CAuBK;MAvB4BiB,GAAG,EAAED,OAAO,CAACE;QAC1ChB,mBAAA,CAAyB,YAAAM,gBAAA,CAAlBQ,OAAO,CAACE,EAAE,kBACjBhB,mBAAA,CAA2B,YAAAM,gBAAA,CAApBQ,OAAO,CAACG,IAAI,kBACnBjB,mBAAA,CAAwC,YAApC,GAAC,GAAAM,gBAAA,CAAGQ,OAAO,CAACI,KAAK,CAACC,OAAO,qBAC7BnB,mBAAA,CAIK,aAHWc,OAAO,CAACM,MAAM,I,cAA1BtB,mBAAA,CAA2D,QAA3DuB,UAA2D,EAAT,IAAE,M,cACpDvB,mBAAA,CAA+C,QAA/CwB,UAA+C,EAAV,KAAG,IAC5BR,OAAO,CAACS,MAAM,I,cAA1BzB,mBAAA,CAA+D,QAA/D0B,UAA+D,EAAb,QAAM,K,qCAE5DxB,mBAAA,CAA4C,YAAAM,gBAAA,CAArCmB,QAAA,CAAAC,UAAU,CAACZ,OAAO,CAACa,SAAS,mBACnC3B,mBAAA,CAYK,aAXDO,mBAAA,UAAa,EACbP,mBAAA,CAAoE;MAAhE4B,IAAI,8BAA8Bd,OAAO,CAACE,EAAE;MAAEnB,KAAK,EAAC;OAAM,IAAE,iBAAAgC,UAAA,GAEhEtB,mBAAA,gBAAmB,EACnBP,mBAAA,CAMS;MALDH,KAAK,EAAAiC,eAAA,EAAC,KAAK;QAAA,iBACgBhB,OAAO,CAACM,MAAM;QAAA,gBAAkBN,OAAO,CAACM;MAAM;MACxEW,OAAK,EAAAC,MAAA,IAAEP,QAAA,CAAAQ,YAAY,CAACnB,OAAO;MAC3BoB,QAAQ,EAAEpB,OAAO,CAACM,MAAM,IAAIK,QAAA,CAAAU,sBAAsB;wBACpDrB,OAAO,CAACM,MAAM,8CAAAgB,WAAA,E;4EAOrBnC,KAAA,CAAAC,OAAO,IAAID,KAAA,CAAAO,QAAQ,CAACC,MAAM,U,cAAtCX,mBAAA,CAEM,OAFNuC,WAEM,EAFmE,UAEzE,K","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}