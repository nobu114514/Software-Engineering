{"ast":null,"code":"import axios from 'axios';\nexport default {\n  name: 'RichTextEditor',\n  props: {\n    modelValue: {\n      type: String,\n      default: ''\n    },\n    label: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      editorId: `editor-${Math.random().toString(36).substr(2, 9)}`,\n      editor: null,\n      config: null\n    };\n  },\n  watch: {\n    modelValue(newValue) {\n      if (this.editor && newValue !== this.editor.getContent()) {\n        this.editor.setContent(newValue);\n      }\n    },\n    disabled(newValue) {\n      if (this.editor) {\n        this.editor.setMode(newValue ? 'readonly' : 'design');\n      }\n    }\n  },\n  mounted() {\n    this.loadTinyMCE().then(() => {\n      this.initEditor();\n    });\n  },\n  beforeUnmount() {\n    if (this.editor) {\n      this.editor.destroy();\n    }\n  },\n  methods: {\n    async loadTinyMCE() {\n      // 动态加载TinyMCE脚本\n      if (window.tinymce) {\n        return Promise.resolve();\n      }\n      return new Promise(resolve => {\n        const script = document.createElement('script');\n        script.src = 'https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js';\n        script.onload = resolve;\n        document.head.appendChild(script);\n      });\n    },\n    async initEditor() {\n      // 获取编辑器配置信息\n      try {\n        const response = await axios.get('/files/editor/config');\n        this.config = response.data;\n      } catch (error) {\n        console.error('获取编辑器配置失败:', error);\n        // 使用默认配置\n        this.config = {\n          uploadUrl: '/files/upload/images',\n          allowedImageFormats: ['jpg', 'jpeg', 'png', 'gif', 'webp'],\n          maxFileSize: 5 * 1024 * 1024,\n          maxFileCount: 10\n        };\n      }\n\n      // 初始化TinyMCE编辑器\n      window.tinymce.init({\n        selector: `#${this.editorId}`,\n        height: 400,\n        plugins: ['advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview', 'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen', 'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount'],\n        toolbar: 'undo redo | formatselect | ' + 'bold italic backcolor | alignleft aligncenter ' + 'alignright alignjustify | bullist numlist outdent indent | ' + 'removeformat | help | image',\n        content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }',\n        images_upload_url: this.config.uploadUrl,\n        images_upload_handler: this.handleImageUpload,\n        images_reuse_filename: true,\n        menubar: false,\n        statusbar: true,\n        setup: editor => {\n          this.editor = editor;\n          editor.on('init', () => {\n            if (this.modelValue) {\n              editor.setContent(this.modelValue);\n            }\n          });\n          editor.on('Change', () => {\n            this.$emit('update:modelValue', editor.getContent());\n          });\n        }\n      });\n    },\n    handleImageUpload(blobInfo, progress) {\n      return new Promise((resolve, reject) => {\n        const formData = new FormData();\n        formData.append('files', blobInfo.blob());\n        axios.post('/files/upload/images', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          },\n          onUploadProgress: e => {\n            progress(e.loaded / e.total * 100);\n          }\n        }).then(response => {\n          if (response.data && response.data.imageUrls && response.data.imageUrls.length > 0) {\n            resolve(response.data.imageUrls[0]);\n          } else {\n            reject('图片上传失败：' + (response.data?.errors?.[0] || '未知错误'));\n          }\n        }).catch(error => {\n          reject('图片上传失败：' + (error.response?.data?.message || error.message));\n        });\n      });\n    },\n    // 获取编辑器内容\n    getContent() {\n      return this.editor ? this.editor.getContent() : '';\n    },\n    // 设置编辑器内容\n    setContent(content) {\n      if (this.editor) {\n        this.editor.setContent(content);\n      }\n    },\n    // 清空编辑器\n    clear() {\n      if (this.editor) {\n        this.editor.setContent('');\n        this.$emit('update:modelValue', '');\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","name","props","modelValue","type","String","default","label","disabled","Boolean","data","editorId","Math","random","toString","substr","editor","config","watch","newValue","getContent","setContent","setMode","mounted","loadTinyMCE","then","initEditor","beforeUnmount","destroy","methods","window","tinymce","Promise","resolve","script","document","createElement","src","onload","head","appendChild","response","get","error","console","uploadUrl","allowedImageFormats","maxFileSize","maxFileCount","init","selector","height","plugins","toolbar","content_style","images_upload_url","images_upload_handler","handleImageUpload","images_reuse_filename","menubar","statusbar","setup","on","$emit","blobInfo","progress","reject","formData","FormData","append","blob","post","headers","onUploadProgress","e","loaded","total","imageUrls","length","errors","catch","message","content","clear"],"sources":["E:\\Software-Engineering\\litemall\\simple-shop-frontend\\frontend\\src\\components\\RichTextEditor.vue"],"sourcesContent":["<template>\n  <div class=\"editor-container\">\n    <label v-if=\"label\" class=\"editor-label\">{{ label }}</label>\n    <textarea :id=\"editorId\"></textarea>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\n\nexport default {\n  name: 'RichTextEditor',\n  props: {\n    modelValue: {\n      type: String,\n      default: ''\n    },\n    label: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      editorId: `editor-${Math.random().toString(36).substr(2, 9)}`,\n      editor: null,\n      config: null\n    }\n  },\n  watch: {\n    modelValue(newValue) {\n      if (this.editor && newValue !== this.editor.getContent()) {\n        this.editor.setContent(newValue)\n      }\n    },\n    disabled(newValue) {\n      if (this.editor) {\n        this.editor.setMode(newValue ? 'readonly' : 'design')\n      }\n    }\n  },\n  mounted() {\n    this.loadTinyMCE().then(() => {\n      this.initEditor()\n    })\n  },\n  beforeUnmount() {\n    if (this.editor) {\n      this.editor.destroy()\n    }\n  },\n  methods: {\n    async loadTinyMCE() {\n      // 动态加载TinyMCE脚本\n      if (window.tinymce) {\n        return Promise.resolve()\n      }\n\n      return new Promise((resolve) => {\n        const script = document.createElement('script')\n        script.src = 'https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js'\n        script.onload = resolve\n        document.head.appendChild(script)\n      })\n    },\n\n    async initEditor() {\n      // 获取编辑器配置信息\n      try {\n        const response = await axios.get('/files/editor/config')\n        this.config = response.data\n      } catch (error) {\n        console.error('获取编辑器配置失败:', error)\n        // 使用默认配置\n        this.config = {\n          uploadUrl: '/files/upload/images',\n          allowedImageFormats: ['jpg', 'jpeg', 'png', 'gif', 'webp'],\n          maxFileSize: 5 * 1024 * 1024,\n          maxFileCount: 10\n        }\n      }\n\n      // 初始化TinyMCE编辑器\n      window.tinymce.init({\n        selector: `#${this.editorId}`,\n        height: 400,\n        plugins: [\n          'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',\n          'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',\n          'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount'\n        ],\n        toolbar: 'undo redo | formatselect | ' +\n          'bold italic backcolor | alignleft aligncenter ' +\n          'alignright alignjustify | bullist numlist outdent indent | ' +\n          'removeformat | help | image',\n        content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }',\n        images_upload_url: this.config.uploadUrl,\n        images_upload_handler: this.handleImageUpload,\n        images_reuse_filename: true,\n        menubar: false,\n        statusbar: true,\n        setup: (editor) => {\n          this.editor = editor\n          editor.on('init', () => {\n            if (this.modelValue) {\n              editor.setContent(this.modelValue)\n            }\n          })\n          editor.on('Change', () => {\n            this.$emit('update:modelValue', editor.getContent())\n          })\n        }\n      })\n    },\n\n    handleImageUpload(blobInfo, progress) {\n      return new Promise((resolve, reject) => {\n        const formData = new FormData()\n        formData.append('files', blobInfo.blob())\n\n        axios.post('/files/upload/images', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          },\n          onUploadProgress: (e) => {\n            progress(e.loaded / e.total * 100)\n          }\n        })\n        .then(response => {\n          if (response.data && response.data.imageUrls && response.data.imageUrls.length > 0) {\n            resolve(response.data.imageUrls[0])\n          } else {\n            reject('图片上传失败：' + (response.data?.errors?.[0] || '未知错误'))\n          }\n        })\n        .catch(error => {\n          reject('图片上传失败：' + (error.response?.data?.message || error.message))\n        })\n      })\n    },\n\n    // 获取编辑器内容\n    getContent() {\n      return this.editor ? this.editor.getContent() : ''\n    },\n\n    // 设置编辑器内容\n    setContent(content) {\n      if (this.editor) {\n        this.editor.setContent(content)\n      }\n    },\n\n    // 清空编辑器\n    clear() {\n      if (this.editor) {\n        this.editor.setContent('')\n        this.$emit('update:modelValue', '')\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.editor-container {\n  margin-bottom: 20px;\n}\n\n.editor-label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 500;\n  color: #333;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}