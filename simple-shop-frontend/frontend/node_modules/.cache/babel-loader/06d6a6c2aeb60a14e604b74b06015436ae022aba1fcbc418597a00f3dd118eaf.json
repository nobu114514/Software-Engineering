{"ast":null,"code":"export default {\n  name: 'RichTextEditor',\n  props: {\n    modelValue: {\n      type: String,\n      default: ''\n    },\n    label: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      localValue: this.modelValue\n    };\n  },\n  watch: {\n    modelValue(newVal) {\n      if (newVal !== this.localValue) {\n        this.localValue = newVal;\n      }\n    }\n  },\n  methods: {\n    updateContent() {\n      this.localValue = this.$refs.editorRef.innerHTML;\n      this.$emit('update:modelValue', this.localValue);\n    },\n    formatText(command) {\n      document.execCommand(command, false, null);\n      this.$refs.editorRef.focus();\n      this.updateContent();\n    },\n    insertImage() {\n      this.$refs.fileInput.click();\n    },\n    handleImageUpload(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n      const formData = new FormData();\n      formData.append('files', file);\n      fetch('/api/files/upload/images', {\n        method: 'POST',\n        body: formData\n      }).then(response => response.json()).then(data => {\n        if (data && data.imageUrls && data.imageUrls.length > 0) {\n          this.insertImageToEditor(data.imageUrls[0]);\n        } else {\n          alert('上传失败: ' + (data?.errors?.[0] || data?.error || '未知错误'));\n        }\n      }).catch(error => {\n        alert('上传失败: ' + error.message);\n      }).finally(() => {\n        // 清空文件输入，允许重复上传相同文件\n        event.target.value = '';\n      });\n    },\n    insertImageToEditor(imageUrl) {\n      // 创建图片元素\n      const img = document.createElement('img');\n      img.src = imageUrl;\n      img.style.maxWidth = '100%';\n\n      // 获取当前选中区域\n      const selection = window.getSelection();\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        range.deleteContents();\n        range.insertNode(img);\n        // 将光标移动到图片后面\n        range.setStartAfter(img);\n        range.setEndAfter(img);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      } else {\n        // 如果没有选中区域，直接追加到编辑器末尾\n        this.$refs.editorRef.appendChild(img);\n      }\n      this.updateContent();\n      this.$refs.editorRef.focus();\n    },\n    // 获取编辑器内容\n    getContent() {\n      return this.localValue;\n    },\n    // 设置编辑器内容\n    setContent(content) {\n      this.localValue = content;\n      this.$emit('update:modelValue', content);\n    },\n    // 清空编辑器\n    clear() {\n      this.localValue = '';\n      this.$emit('update:modelValue', '');\n    }\n  }\n};","map":{"version":3,"names":["name","props","modelValue","type","String","default","label","disabled","Boolean","data","localValue","watch","newVal","methods","updateContent","$refs","editorRef","innerHTML","$emit","formatText","command","document","execCommand","focus","insertImage","fileInput","click","handleImageUpload","event","file","target","files","formData","FormData","append","fetch","method","body","then","response","json","imageUrls","length","insertImageToEditor","alert","errors","error","catch","message","finally","value","imageUrl","img","createElement","src","style","maxWidth","selection","window","getSelection","rangeCount","range","getRangeAt","deleteContents","insertNode","setStartAfter","setEndAfter","removeAllRanges","addRange","appendChild","getContent","setContent","content","clear"],"sources":["E:\\Software-Engineering\\litemall\\simple-shop-frontend\\frontend\\src\\components\\RichTextEditor.vue"],"sourcesContent":["<template>\n  <div class=\"editor-container\">\n    <label v-if=\"label\" class=\"editor-label\">{{ label }}</label>\n    <div ref=\"editorRef\" class=\"rich-text-editor\"\n         :contenteditable=\"!disabled\"\n         v-html=\"localValue\"\n         @input=\"updateContent\"></div>\n    <div class=\"toolbar\" v-if=\"!disabled\">\n      <button @click=\"formatText('bold')\">粗体</button>\n      <button @click=\"formatText('italic')\">斜体</button>\n      <button @click=\"formatText('underline')\">下划线</button>\n      <button @click=\"insertImage\">插入图片</button>\n      <input ref=\"fileInput\" type=\"file\" accept=\"image/*\" style=\"display: none\" @change=\"handleImageUpload\">\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'RichTextEditor',\n  props: {\n    modelValue: {\n      type: String,\n      default: ''\n    },\n    label: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      localValue: this.modelValue\n    }\n  },\n  watch: {\n    modelValue(newVal) {\n      if (newVal !== this.localValue) {\n        this.localValue = newVal\n      }\n    }\n  },\n  methods: {\n    updateContent() {\n      this.localValue = this.$refs.editorRef.innerHTML\n      this.$emit('update:modelValue', this.localValue)\n    },\n    formatText(command) {\n      document.execCommand(command, false, null)\n      this.$refs.editorRef.focus()\n      this.updateContent()\n    },\n    insertImage() {\n      this.$refs.fileInput.click()\n    },\n    handleImageUpload(event) {\n      const file = event.target.files[0]\n      if (!file) return\n      \n      const formData = new FormData()\n      formData.append('files', file)\n      \n      fetch('/api/files/upload/images', {\n        method: 'POST',\n        body: formData\n      })\n      .then(response => response.json())\n      .then(data => {\n        if (data && data.imageUrls && data.imageUrls.length > 0) {\n          this.insertImageToEditor(data.imageUrls[0])\n        } else {\n          alert('上传失败: ' + (data?.errors?.[0] || data?.error || '未知错误'))\n        }\n      })\n      .catch(error => {\n        alert('上传失败: ' + error.message)\n      })\n      .finally(() => {\n        // 清空文件输入，允许重复上传相同文件\n        event.target.value = ''\n      })\n    },\n    insertImageToEditor(imageUrl) {\n      // 创建图片元素\n      const img = document.createElement('img')\n      img.src = imageUrl\n      img.style.maxWidth = '100%'\n      \n      // 获取当前选中区域\n      const selection = window.getSelection()\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0)\n        range.deleteContents()\n        range.insertNode(img)\n        // 将光标移动到图片后面\n        range.setStartAfter(img)\n        range.setEndAfter(img)\n        selection.removeAllRanges()\n        selection.addRange(range)\n      } else {\n        // 如果没有选中区域，直接追加到编辑器末尾\n        this.$refs.editorRef.appendChild(img)\n      }\n      \n      this.updateContent()\n      this.$refs.editorRef.focus()\n    },\n    // 获取编辑器内容\n    getContent() {\n      return this.localValue\n    },\n    // 设置编辑器内容\n    setContent(content) {\n      this.localValue = content\n      this.$emit('update:modelValue', content)\n    },\n    // 清空编辑器\n    clear() {\n      this.localValue = ''\n      this.$emit('update:modelValue', '')\n    }\n  }\n}\n</script>\n\n<style scoped>\n.editor-container {\n  margin-bottom: 20px;\n}\n\n.editor-label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 500;\n  color: #333;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}