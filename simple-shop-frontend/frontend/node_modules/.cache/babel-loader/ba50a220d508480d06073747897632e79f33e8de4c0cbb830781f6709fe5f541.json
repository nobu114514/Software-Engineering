{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport RichTextEditor from '../components/RichTextEditor.vue';\nexport default {\n  name: 'ProductForm',\n  components: {\n    RichTextEditor\n  },\n  data() {\n    return {\n      product: {\n        name: '',\n        price: 0,\n        imageUrl: '',\n        description: '',\n        subCategory: null\n      },\n      isEditing: false,\n      loading: true,\n      error: '',\n      success: false,\n      categories: [],\n      subCategories: [],\n      selectedCategoryId: null\n    };\n  },\n  created() {\n    const productId = this.$route.query.id;\n    if (productId) {\n      this.isEditing = true;\n      Promise.all([this.fetchCategories(), this.fetchProduct(productId)]).finally(() => {\n        this.loading = false;\n      });\n    } else {\n      this.fetchCategories().finally(() => {\n        this.loading = false;\n      });\n    }\n  },\n  watch: {\n    selectedCategoryId(newVal) {\n      this.loadSubCategories(newVal);\n    }\n  },\n  methods: {\n    async fetchCategories() {\n      try {\n        const response = await this.$axios.get('/categories/active');\n        this.categories = response.data;\n      } catch (err) {\n        console.error('获取分类信息失败', err);\n      }\n    },\n    async loadSubCategories(categoryId) {\n      if (!categoryId) {\n        this.subCategories = [];\n        this.product.subCategory = null;\n        return;\n      }\n      try {\n        const response = await this.$axios.get(`/sub-categories/category/${categoryId}`);\n        this.subCategories = response.data;\n        // 清除之前选择的二级分类\n        this.product.subCategory = null;\n      } catch (err) {\n        console.error('获取二级分类信息失败', err);\n      }\n    },\n    async fetchProduct(id) {\n      try {\n        const response = await this.$axios.get(`/products/${id}`);\n        this.product = response.data;\n        // 如果商品有二级分类，设置选中的分类\n        if (this.product.subCategory && this.product.subCategory.category) {\n          this.selectedCategoryId = this.product.subCategory.category.id;\n          // 等待分类列表加载完成后再加载二级分类\n          await this.$nextTick();\n          this.loadSubCategories(this.selectedCategoryId);\n        }\n        this.error = '';\n      } catch (err) {\n        this.error = '获取商品信息失败';\n        console.error(err);\n      }\n    },\n    async saveProduct() {\n      try {\n        if (this.isEditing) {\n          await this.$axios.put(`/products/${this.product.id}`, this.product);\n        } else {\n          await this.$axios.post('/products', this.product);\n        }\n        this.success = true;\n        // 重置表单或跳转\n        setTimeout(() => {\n          this.$router.push('/seller/dashboard');\n        }, 1500);\n      } catch (err) {\n        this.error = this.isEditing ? '更新商品失败' : '发布商品失败';\n        console.error(err);\n      }\n    }\n  }\n};","map":{"version":3,"names":["RichTextEditor","name","components","data","product","price","imageUrl","description","subCategory","isEditing","loading","error","success","categories","subCategories","selectedCategoryId","created","productId","$route","query","id","Promise","all","fetchCategories","fetchProduct","finally","watch","newVal","loadSubCategories","methods","response","$axios","get","err","console","categoryId","category","$nextTick","saveProduct","put","post","setTimeout","$router","push"],"sources":["E:\\Software-Engineering2.0\\Software-Engineering-9bea62c8ef6d7754a2d932a0227f9bc4fff09a3c\\litemall\\simple-shop-frontend\\frontend\\src\\views\\ProductForm.vue"],"sourcesContent":["<template>\n  <div class=\"product-form\">\n    <h1>{{ isEditing ? '编辑商品' : '发布新商品' }}</h1>\n    \n    <div v-if=\"loading\" class=\"loading\">加载中...</div>\n    \n    <div v-if=\"error\" class=\"alert alert-danger\">\n      {{ error }}\n    </div>\n    \n    <div v-if=\"success\" class=\"alert alert-success\">\n      {{ isEditing ? '商品更新成功' : '商品发布成功' }}\n    </div>\n    \n    <form @submit.prevent=\"saveProduct\" v-if=\"!loading\" class=\"card\">\n      <div class=\"form-group\">\n        <label for=\"name\">商品名称</label>\n        <input type=\"text\" id=\"name\" v-model=\"product.name\" required>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"category\">商品分类</label>\n        <select id=\"category\" v-model=\"selectedCategoryId\" required>\n          <option value=\"\">请选择一级分类</option>\n          <option v-for=\"category in categories\" :key=\"category.id\" :value=\"category.id\">\n            {{ category.name }}\n          </option>\n        </select>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"subCategory\">商品子分类</label>\n        <select id=\"subCategory\" v-model=\"product.subCategory\" required>\n          <option value=\"\">请选择二级分类</option>\n          <option v-for=\"subCategory in subCategories\" :key=\"subCategory.id\" :value=\"subCategory\">\n            {{ subCategory.name }}\n          </option>\n        </select>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"price\">商品价格</label>\n        <input type=\"number\" id=\"price\" v-model=\"product.price\" min=\"0\" step=\"0.01\" required>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"imageUrl\">商品主图URL</label>\n        <input type=\"text\" id=\"imageUrl\" v-model=\"product.imageUrl\" \n               placeholder=\"输入图片URL，如：https://picsum.photos/600/400\">\n        <p class=\"help-text\">您也可以在下方的商品详情中插入更多图片</p>\n      </div>\n      <div class=\"form-group\">\n        <label>商品详情</label>\n        <RichTextEditor v-model=\"product.description\" label=\"\" />\n      </div>\n      <div class=\"form-actions\">\n        <button type=\"submit\" class=\"btn\">{{ isEditing ? '更新商品' : '发布商品' }}</button>\n        <a href=\"/seller/dashboard\" class=\"btn btn-secondary\">取消</a>\n      </div>\n    </form>\n  </div>\n</template>\n\n<script>\nimport RichTextEditor from '../components/RichTextEditor.vue'\n\nexport default {\n  name: 'ProductForm',\n  components: {\n    RichTextEditor\n  },\n  data() {\n    return {\n      product: {\n        name: '',\n        price: 0,\n        imageUrl: '',\n        description: '',\n        subCategory: null\n      },\n      isEditing: false,\n      loading: true,\n      error: '',\n      success: false,\n      categories: [],\n      subCategories: [],\n      selectedCategoryId: null\n    }\n  },\n  created() {\n    const productId = this.$route.query.id\n    if (productId) {\n      this.isEditing = true\n      Promise.all([this.fetchCategories(), this.fetchProduct(productId)])\n        .finally(() => {\n          this.loading = false\n        })\n    } else {\n      this.fetchCategories().finally(() => {\n        this.loading = false\n      })\n    }\n  },\n  watch: {\n    selectedCategoryId(newVal) {\n      this.loadSubCategories(newVal)\n    }\n  },\n  methods: {\n    async fetchCategories() {\n      try {\n        const response = await this.$axios.get('/categories/active')\n        this.categories = response.data\n      } catch (err) {\n        console.error('获取分类信息失败', err)\n      }\n    },\n    \n    async loadSubCategories(categoryId) {\n      if (!categoryId) {\n        this.subCategories = []\n        this.product.subCategory = null\n        return\n      }\n      try {\n        const response = await this.$axios.get(`/sub-categories/category/${categoryId}`)\n        this.subCategories = response.data\n        // 清除之前选择的二级分类\n        this.product.subCategory = null\n      } catch (err) {\n        console.error('获取二级分类信息失败', err)\n      }\n    },\n    \n    async fetchProduct(id) {\n      try {\n        const response = await this.$axios.get(`/products/${id}`)\n        this.product = response.data\n        // 如果商品有二级分类，设置选中的分类\n        if (this.product.subCategory && this.product.subCategory.category) {\n          this.selectedCategoryId = this.product.subCategory.category.id\n          // 等待分类列表加载完成后再加载二级分类\n          await this.$nextTick()\n          this.loadSubCategories(this.selectedCategoryId)\n        }\n        this.error = ''\n      } catch (err) {\n        this.error = '获取商品信息失败'\n        console.error(err)\n      }\n    },\n    async saveProduct() {\n      try {\n        if (this.isEditing) {\n          await this.$axios.put(`/products/${this.product.id}`, this.product)\n        } else {\n          await this.$axios.post('/products', this.product)\n        }\n        this.success = true\n        // 重置表单或跳转\n        setTimeout(() => {\n          this.$router.push('/seller/dashboard')\n        }, 1500)\n      } catch (err) {\n        this.error = this.isEditing ? '更新商品失败' : '发布商品失败'\n        console.error(err)\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.form-actions {\n  margin-top: 1.5rem;\n  display: flex;\n  gap: 1rem;\n}\n\n.loading {\n  text-align: center;\n  padding: 2rem;\n  font-size: 1.2rem;\n}\n\n.form-group {\n  margin-bottom: 1rem;\n}\n\nlabel {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-weight: 500;\n}\n\ninput[type=\"text\"],\ninput[type=\"number\"],\ntextarea {\n  width: 100%;\n  padding: 0.75rem;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  font-size: 1rem;\n}\n\n.help-text {\n  margin-top: 0.5rem;\n  font-size: 0.875rem;\n  color: #666;\n}\n\n/* 富文本编辑器容器样式 */\n:deep(.rich-text-editor) {\n  min-height: 200px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  padding: 1rem;\n  margin-bottom: 0.5rem;\n  outline: none;\n}\n\n:deep(.rich-text-editor:focus) {\n  border-color: #4a90e2;\n}\n\n:deep(.toolbar) {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 1rem;\n  flex-wrap: wrap;\n}\n\n:deep(.toolbar button) {\n  padding: 0.5rem 0.75rem;\n  background-color: #f5f5f5;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 0.875rem;\n}\n\n:deep(.toolbar button:hover) {\n  background-color: #e9e9e9;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}