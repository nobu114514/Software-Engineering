{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nexport default {\n  name: 'ProductHistory',\n  data() {\n    return {\n      products: [],\n      loading: true,\n      error: ''\n    };\n  },\n  created() {\n    this.fetchProducts();\n  },\n  methods: {\n    async fetchProducts() {\n      try {\n        this.loading = true;\n        const response = await this.$axios.get('/products'); // 实际请求：http://localhost:8081/api/products\n        this.products = response.data;\n        this.error = '';\n      } catch (err) {\n        this.error = '获取商品列表失败';\n        console.error(err);\n      } finally {\n        this.loading = false;\n      }\n    },\n    // 获取当前在售商品数量\n    getActiveProductsCount() {\n      return this.products.filter(p => p.isActive).length;\n    },\n    async toggleActive(product) {\n      try {\n        if (product.isActive) {\n          // 当前是“在售”，执行下架\n          await this.$axios.put(`/products/${product.id}/deactivate`);\n        } else {\n          // 当前是“已下架”，执行上架\n          // 先检查是否有其他在售商品\n          const activeProducts = this.products.filter(p => p.isActive && p.id !== product.id);\n\n          // 先上架当前商品\n          await this.$axios.put(`/products/${product.id}/activate`);\n\n          // 再将其他所有在售商品下架\n          if (activeProducts.length > 0) {\n            // 显示提示信息\n            this.error = `已自动将 ${activeProducts.length} 个商品下架，确保只有一个在售商品`;\n\n            // 延迟清除提示信息\n            setTimeout(() => {\n              this.error = '';\n            }, 3000);\n\n            // 逐个下架其他商品\n            for (const p of activeProducts) {\n              await this.$axios.put(`/products/${p.id}/deactivate`);\n            }\n          }\n        }\n\n        // 刷新商品列表\n        this.fetchProducts();\n      } catch (err) {\n        this.error = '操作失败，请重试';\n        console.error(err);\n      }\n    },\n    formatDate(dateString) {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleString();\n    }\n  }\n};","map":{"version":3,"names":["name","data","products","loading","error","created","fetchProducts","methods","response","$axios","get","err","console","getActiveProductsCount","filter","p","isActive","length","toggleActive","product","put","id","activeProducts","setTimeout","formatDate","dateString","date","Date","toLocaleString"],"sources":["D:\\game\\Trae\\litemall\\simple-shop-frontend\\frontend\\src\\views\\ProductHistory.vue"],"sourcesContent":["<template>\n    <div class=\"product-history\">\n        <h1>商品历史记录</h1>\n\n        <div v-if=\"loading\" class=\"loading\">加载中...</div>\n\n        <div v-if=\"error\" class=\"alert alert-danger\">\n            {{ error }}\n        </div>\n\n        <!-- 提示信息：当前系统只允许一个商品在售 -->\n        <div class=\"alert alert-info\" v-if=\"!loading && products.length > 0\">\n            系统提示：当前仅允许一个商品处于在售状态，新商品上架时其他商品将自动下架\n        </div>\n\n        <table v-if=\"!loading && products.length > 0\" class=\"product-table\">\n            <thead>\n            <tr>\n                <th>ID</th>\n                <th>名称</th>\n                <th>价格</th>\n                <th>状态</th>\n                <th>创建时间</th>\n                <th>操作</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr v-for=\"product in products\" :key=\"product.id\">\n                <td>{{ product.id }}</td>\n                <td>{{ product.name }}</td>\n                <td>¥{{ product.price.toFixed(2) }}</td>\n                <td>\n                    <span v-if=\"product.active\" class=\"status-active\">在售</span>\n                    <span v-else class=\"status-inactive\">已下架</span>\n                    <span v-if=\"product.frozen\" class=\"status-frozen\"> (已冻结)</span>\n                </td>\n                <td>{{ formatDate(product.createdAt) }}</td>\n                <td>\n                    <!-- 编辑按钮 -->\n                    <a :href=\"'/seller/product/new?id=' + product.id\" class=\"btn\">编辑</a>\n\n                    <!-- 上架 / 下架 按钮 -->\n                    <button\n                            class=\"btn\"\n                            :class=\"{ 'btn-secondary': product.active, 'btn-success': !product.active }\"\n                            @click=\"toggleActive(product)\"\n                            :disabled=\"product.active && getActiveProductsCount() <= 1\">\n                        {{ product.active ? '下架' : '上架' }}\n                    </button>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div v-if=\"!loading && products.length === 0\" class=\"alert alert-danger\">\n            暂无商品记录\n        </div>\n    </div>\n</template>\n\n<script>\n    export default {\n      name: 'ProductHistory',\n      data() {\n        return {\n          products: [],\n          loading: true,\n          error: ''\n        }\n      },\n      created() {\n        this.fetchProducts()\n      },\n      methods: {\n        async fetchProducts() {\n          try {\n            this.loading = true\n            const response = await this.$axios.get('/products') // 实际请求：http://localhost:8081/api/products\n            this.products = response.data\n            this.error = ''\n          } catch (err) {\n            this.error = '获取商品列表失败'\n            console.error(err)\n          } finally {\n            this.loading = false\n          }\n        },\n\n        // 获取当前在售商品数量\n        getActiveProductsCount() {\n          return this.products.filter(p => p.isActive).length\n        },\n\n        async toggleActive(product) {\n          try {\n            if (product.isActive) {\n              // 当前是“在售”，执行下架\n              await this.$axios.put(`/products/${product.id}/deactivate`)\n            } else {\n              // 当前是“已下架”，执行上架\n              // 先检查是否有其他在售商品\n              const activeProducts = this.products.filter(p => p.isActive && p.id !== product.id)\n\n              // 先上架当前商品\n              await this.$axios.put(`/products/${product.id}/activate`)\n\n              // 再将其他所有在售商品下架\n              if (activeProducts.length > 0) {\n                // 显示提示信息\n                this.error = `已自动将 ${activeProducts.length} 个商品下架，确保只有一个在售商品`\n\n                // 延迟清除提示信息\n                setTimeout(() => {\n                  this.error = ''\n                }, 3000)\n\n                // 逐个下架其他商品\n                for (const p of activeProducts) {\n                  await this.$axios.put(`/products/${p.id}/deactivate`)\n                }\n              }\n            }\n\n            // 刷新商品列表\n            this.fetchProducts()\n          } catch (err) {\n            this.error = '操作失败，请重试'\n            console.error(err)\n          }\n        },\n\n        formatDate(dateString) {\n          if (!dateString) return ''\n          const date = new Date(dateString)\n          return date.toLocaleString()\n        }\n      }\n    }\n</script>\n\n<style scoped>\n    .loading {\n      text-align: center;\n      padding: 2rem;\n      font-size: 1.2rem;\n    }\n\n    .alert {\n      padding: 1rem;\n      margin: 1rem 0;\n      border-radius: 4px;\n    }\n\n    .alert-danger {\n      background-color: #f8d7da;\n      color: #721c24;\n      border: 1px solid #f5c6cb;\n    }\n\n    .alert-info {\n      background-color: #d1ecf1;\n      color: #0c5460;\n      border: 1px solid #bee5eb;\n    }\n\n    .product-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin-top: 1rem;\n    }\n\n    .product-table th,\n    .product-table td {\n      padding: 0.75rem;\n      text-align: left;\n      border-bottom: 1px solid #ddd;\n    }\n\n    .status-active {\n      color: #28a745;\n      font-weight: bold;\n    }\n\n    .status-inactive {\n      color: #6c757d;\n    }\n\n    .status-frozen {\n      color: #dc3545;\n    }\n\n    .btn {\n      margin-right: 0.5rem;\n      padding: 0.25rem 0.75rem;\n      color: white;\n      text-decoration: none;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    /* 下架按钮 - 灰色 */\n    .btn-secondary {\n      background: #6c757d;\n    }\n\n    /* 上架按钮 - 绿色 */\n    .btn-success {\n      background: #28a745;\n    }\n\n    .btn:disabled {\n      background: #ccc;\n      cursor: not-allowed;\n    }\n</style>\n"],"mappings":";;AA6DI,eAAe;EACbA,IAAI,EAAE,gBAAgB;EACtBC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,QAAQ,EAAE,EAAE;MACZC,OAAO,EAAE,IAAI;MACbC,KAAK,EAAE;IACT;EACF,CAAC;EACDC,OAAOA,CAAA,EAAG;IACR,IAAI,CAACC,aAAa,CAAC;EACrB,CAAC;EACDC,OAAO,EAAE;IACP,MAAMD,aAAaA,CAAA,EAAG;MACpB,IAAI;QACF,IAAI,CAACH,OAAM,GAAI,IAAG;QAClB,MAAMK,QAAO,GAAI,MAAM,IAAI,CAACC,MAAM,CAACC,GAAG,CAAC,WAAW,GAAE;QACpD,IAAI,CAACR,QAAO,GAAIM,QAAQ,CAACP,IAAG;QAC5B,IAAI,CAACG,KAAI,GAAI,EAAC;MAChB,EAAE,OAAOO,GAAG,EAAE;QACZ,IAAI,CAACP,KAAI,GAAI,UAAS;QACtBQ,OAAO,CAACR,KAAK,CAACO,GAAG;MACnB,UAAU;QACR,IAAI,CAACR,OAAM,GAAI,KAAI;MACrB;IACF,CAAC;IAED;IACAU,sBAAsBA,CAAA,EAAG;MACvB,OAAO,IAAI,CAACX,QAAQ,CAACY,MAAM,CAACC,CAAA,IAAKA,CAAC,CAACC,QAAQ,CAAC,CAACC,MAAK;IACpD,CAAC;IAED,MAAMC,YAAYA,CAACC,OAAO,EAAE;MAC1B,IAAI;QACF,IAAIA,OAAO,CAACH,QAAQ,EAAE;UACpB;UACA,MAAM,IAAI,CAACP,MAAM,CAACW,GAAG,CAAC,aAAaD,OAAO,CAACE,EAAE,aAAa;QAC5D,OAAO;UACL;UACA;UACA,MAAMC,cAAa,GAAI,IAAI,CAACpB,QAAQ,CAACY,MAAM,CAACC,CAAA,IAAKA,CAAC,CAACC,QAAO,IAAKD,CAAC,CAACM,EAAC,KAAMF,OAAO,CAACE,EAAE;;UAElF;UACA,MAAM,IAAI,CAACZ,MAAM,CAACW,GAAG,CAAC,aAAaD,OAAO,CAACE,EAAE,WAAW;;UAExD;UACA,IAAIC,cAAc,CAACL,MAAK,GAAI,CAAC,EAAE;YAC7B;YACA,IAAI,CAACb,KAAI,GAAI,QAAQkB,cAAc,CAACL,MAAM,mBAAkB;;YAE5D;YACAM,UAAU,CAAC,MAAM;cACf,IAAI,CAACnB,KAAI,GAAI,EAAC;YAChB,CAAC,EAAE,IAAI;;YAEP;YACA,KAAK,MAAMW,CAAA,IAAKO,cAAc,EAAE;cAC9B,MAAM,IAAI,CAACb,MAAM,CAACW,GAAG,CAAC,aAAaL,CAAC,CAACM,EAAE,aAAa;YACtD;UACF;QACF;;QAEA;QACA,IAAI,CAACf,aAAa,CAAC;MACrB,EAAE,OAAOK,GAAG,EAAE;QACZ,IAAI,CAACP,KAAI,GAAI,UAAS;QACtBQ,OAAO,CAACR,KAAK,CAACO,GAAG;MACnB;IACF,CAAC;IAEDa,UAAUA,CAACC,UAAU,EAAE;MACrB,IAAI,CAACA,UAAU,EAAE,OAAO,EAAC;MACzB,MAAMC,IAAG,GAAI,IAAIC,IAAI,CAACF,UAAU;MAChC,OAAOC,IAAI,CAACE,cAAc,CAAC;IAC7B;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}