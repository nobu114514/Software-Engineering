{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n  class: \"product-history\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"alert alert-danger\"\n};\nconst _hoisted_4 = {\n  key: 2,\n  class: \"alert alert-info\"\n};\nconst _hoisted_5 = {\n  key: 3,\n  class: \"product-table\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"status-active\"\n};\nconst _hoisted_7 = {\n  key: 1,\n  class: \"status-inactive\"\n};\nconst _hoisted_8 = {\n  key: 2,\n  class: \"status-frozen\"\n};\nconst _hoisted_9 = [\"href\"];\nconst _hoisted_10 = [\"onClick\", \"disabled\"];\nconst _hoisted_11 = {\n  key: 4,\n  class: \"alert alert-danger\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[1] || (_cache[1] = _createElementVNode(\"h1\", null, \"商品历史记录\", -1 /* CACHED */)), $data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"加载中...\")) : _createCommentVNode(\"v-if\", true), $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, _toDisplayString($data.error), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 提示信息：当前系统只允许一个商品在售 \"), !$data.loading && $data.products.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, \" 系统提示：当前仅允许一个商品处于在售状态，新商品上架时其他商品将自动下架 \")) : _createCommentVNode(\"v-if\", true), !$data.loading && $data.products.length > 0 ? (_openBlock(), _createElementBlock(\"table\", _hoisted_5, [_cache[0] || (_cache[0] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", null, \"ID\"), _createElementVNode(\"th\", null, \"名称\"), _createElementVNode(\"th\", null, \"价格\"), _createElementVNode(\"th\", null, \"状态\"), _createElementVNode(\"th\", null, \"创建时间\"), _createElementVNode(\"th\", null, \"操作\")])], -1 /* CACHED */)), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.products, product => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: product.id\n    }, [_createElementVNode(\"td\", null, _toDisplayString(product.id), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(product.name), 1 /* TEXT */), _createElementVNode(\"td\", null, \"¥\" + _toDisplayString(product.price.toFixed(2)), 1 /* TEXT */), _createElementVNode(\"td\", null, [product.active ? (_openBlock(), _createElementBlock(\"span\", _hoisted_6, \"在售\")) : (_openBlock(), _createElementBlock(\"span\", _hoisted_7, \"已下架\")), product.frozen ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, \" (已冻结)\")) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"td\", null, _toDisplayString($options.formatDate(product.createdAt)), 1 /* TEXT */), _createElementVNode(\"td\", null, [_createCommentVNode(\" 编辑按钮 \"), _createElementVNode(\"a\", {\n      href: '/seller/product/new?id=' + product.id,\n      class: \"btn\"\n    }, \"编辑\", 8 /* PROPS */, _hoisted_9), _createCommentVNode(\" 上架 / 下架 按钮 \"), _createElementVNode(\"button\", {\n      class: _normalizeClass([\"btn\", {\n        'btn-secondary': product.active,\n        'btn-success': !product.active\n      }]),\n      onClick: $event => $options.toggleActive(product),\n      disabled: product.active && $options.getActiveProductsCount() <= 1\n    }, _toDisplayString(product.active ? '下架' : '上架'), 11 /* TEXT, CLASS, PROPS */, _hoisted_10)])]);\n  }), 128 /* KEYED_FRAGMENT */))])])) : _createCommentVNode(\"v-if\", true), !$data.loading && $data.products.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, \" 暂无商品记录 \")) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","$data","loading","_hoisted_2","error","_hoisted_3","_toDisplayString","_createCommentVNode","products","length","_hoisted_4","_hoisted_5","_Fragment","_renderList","product","key","id","name","price","toFixed","active","_hoisted_6","_hoisted_7","frozen","_hoisted_8","$options","formatDate","createdAt","href","_hoisted_9","_normalizeClass","onClick","$event","toggleActive","disabled","getActiveProductsCount","_hoisted_10","_hoisted_11"],"sources":["D:\\github\\ruanjianshijian\\Software-Engineering\\litemall\\simple-shop-frontend\\frontend\\src\\views\\ProductHistory.vue"],"sourcesContent":["<template>\r\n    <div class=\"product-history\">\r\n        <h1>商品历史记录</h1>\r\n\r\n        <div v-if=\"loading\" class=\"loading\">加载中...</div>\r\n\r\n        <div v-if=\"error\" class=\"alert alert-danger\">\r\n            {{ error }}\r\n        </div>\r\n\r\n        <!-- 提示信息：当前系统只允许一个商品在售 -->\r\n        <div class=\"alert alert-info\" v-if=\"!loading && products.length > 0\">\r\n            系统提示：当前仅允许一个商品处于在售状态，新商品上架时其他商品将自动下架\r\n        </div>\r\n\r\n        <table v-if=\"!loading && products.length > 0\" class=\"product-table\">\r\n            <thead>\r\n            <tr>\r\n                <th>ID</th>\r\n                <th>名称</th>\r\n                <th>价格</th>\r\n                <th>状态</th>\r\n                <th>创建时间</th>\r\n                <th>操作</th>\r\n            </tr>\r\n            </thead>\r\n            <tbody>\r\n            <tr v-for=\"product in products\" :key=\"product.id\">\r\n                <td>{{ product.id }}</td>\r\n                <td>{{ product.name }}</td>\r\n                <td>¥{{ product.price.toFixed(2) }}</td>\r\n                <td>\r\n                    <span v-if=\"product.active\" class=\"status-active\">在售</span>\r\n                    <span v-else class=\"status-inactive\">已下架</span>\r\n                    <span v-if=\"product.frozen\" class=\"status-frozen\"> (已冻结)</span>\r\n                </td>\r\n                <td>{{ formatDate(product.createdAt) }}</td>\r\n                <td>\r\n                    <!-- 编辑按钮 -->\r\n                    <a :href=\"'/seller/product/new?id=' + product.id\" class=\"btn\">编辑</a>\r\n\r\n                    <!-- 上架 / 下架 按钮 -->\r\n                    <button\r\n                            class=\"btn\"\r\n                            :class=\"{ 'btn-secondary': product.active, 'btn-success': !product.active }\"\r\n                            @click=\"toggleActive(product)\"\r\n                            :disabled=\"product.active && getActiveProductsCount() <= 1\">\r\n                        {{ product.active ? '下架' : '上架' }}\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n            </tbody>\r\n        </table>\r\n\r\n        <div v-if=\"!loading && products.length === 0\" class=\"alert alert-danger\">\r\n            暂无商品记录\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n      name: 'ProductHistory',\r\n      data() {\r\n        return {\r\n          products: [],\r\n          loading: true,\r\n          error: ''\r\n        }\r\n      },\r\n      created() {\r\n        this.fetchProducts()\r\n      },\r\n      methods: {\r\n        async fetchProducts() {\r\n          try {\r\n            this.loading = true\r\n            const response = await this.$axios.get('/products') // 实际请求：http://localhost:8081/api/products\r\n            this.products = response.data\r\n            this.error = ''\r\n          } catch (err) {\r\n            this.error = '获取商品列表失败'\r\n            console.error(err)\r\n          } finally {\r\n            this.loading = false\r\n          }\r\n        },\r\n\r\n        // 获取当前在售商品数量\r\n        getActiveProductsCount() {\r\n          return this.products.filter(p => p.isActive).length\r\n        },\r\n\r\n        async toggleActive(product) {\r\n          try {\r\n            if (product.isActive) {\r\n              // 当前是“在售”，执行下架\r\n              await this.$axios.put(`/products/${product.id}/deactivate`)\r\n            } else {\r\n              // 当前是“已下架”，执行上架\r\n              // 先检查是否有其他在售商品\r\n              const activeProducts = this.products.filter(p => p.isActive && p.id !== product.id)\r\n\r\n              // 先上架当前商品\r\n              await this.$axios.put(`/products/${product.id}/activate`)\r\n\r\n              // 再将其他所有在售商品下架\r\n              if (activeProducts.length > 0) {\r\n                // 显示提示信息\r\n                this.error = `已自动将 ${activeProducts.length} 个商品下架，确保只有一个在售商品`\r\n\r\n                // 延迟清除提示信息\r\n                setTimeout(() => {\r\n                  this.error = ''\r\n                }, 3000)\r\n\r\n                // 逐个下架其他商品\r\n                for (const p of activeProducts) {\r\n                  await this.$axios.put(`/products/${p.id}/deactivate`)\r\n                }\r\n              }\r\n            }\r\n\r\n            // 刷新商品列表\r\n            this.fetchProducts()\r\n          } catch (err) {\r\n            this.error = '操作失败，请重试'\r\n            console.error(err)\r\n          }\r\n        },\r\n\r\n        formatDate(dateString) {\r\n          if (!dateString) return ''\r\n          const date = new Date(dateString)\r\n          return date.toLocaleString()\r\n        }\r\n      }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .loading {\r\n      text-align: center;\r\n      padding: 2rem;\r\n      font-size: 1.2rem;\r\n    }\r\n\r\n    .alert {\r\n      padding: 1rem;\r\n      margin: 1rem 0;\r\n      border-radius: 4px;\r\n    }\r\n\r\n    .alert-danger {\r\n      background-color: #f8d7da;\r\n      color: #721c24;\r\n      border: 1px solid #f5c6cb;\r\n    }\r\n\r\n    .alert-info {\r\n      background-color: #d1ecf1;\r\n      color: #0c5460;\r\n      border: 1px solid #bee5eb;\r\n    }\r\n\r\n    .product-table {\r\n      width: 100%;\r\n      border-collapse: collapse;\r\n      margin-top: 1rem;\r\n    }\r\n\r\n    .product-table th,\r\n    .product-table td {\r\n      padding: 0.75rem;\r\n      text-align: left;\r\n      border-bottom: 1px solid #ddd;\r\n    }\r\n\r\n    .status-active {\r\n      color: #28a745;\r\n      font-weight: bold;\r\n    }\r\n\r\n    .status-inactive {\r\n      color: #6c757d;\r\n    }\r\n\r\n    .status-frozen {\r\n      color: #dc3545;\r\n    }\r\n\r\n    .btn {\r\n      margin-right: 0.5rem;\r\n      padding: 0.25rem 0.75rem;\r\n      color: white;\r\n      text-decoration: none;\r\n      border: none;\r\n      border-radius: 4px;\r\n      cursor: pointer;\r\n    }\r\n\r\n    /* 下架按钮 - 灰色 */\r\n    .btn-secondary {\r\n      background: #6c757d;\r\n    }\r\n\r\n    /* 上架按钮 - 绿色 */\r\n    .btn-success {\r\n      background: #28a745;\r\n    }\r\n\r\n    .btn:disabled {\r\n      background: #ccc;\r\n      cursor: not-allowed;\r\n    }\r\n</style>\r\n"],"mappings":";;EACSA,KAAK,EAAC;AAAiB;;;EAGJA,KAAK,EAAC;;;;EAERA,KAAK,EAAC;;;;EAKnBA,KAAK,EAAC;;;;EAImCA,KAAK,EAAC;;;;EAiBZA,KAAK,EAAC;;;;EACrBA,KAAK,EAAC;;;;EACSA,KAAK,EAAC;;;;;;EAoBAA,KAAK,EAAC;;;uBArDxDC,mBAAA,CAwDM,OAxDNC,UAwDM,G,0BAvDFC,mBAAA,CAAe,YAAX,QAAM,qBAECC,KAAA,CAAAC,OAAO,I,cAAlBJ,mBAAA,CAAgD,OAAhDK,UAAgD,EAAZ,QAAM,K,mCAE/BF,KAAA,CAAAG,KAAK,I,cAAhBN,mBAAA,CAEM,OAFNO,UAEM,EAAAC,gBAAA,CADCL,KAAA,CAAAG,KAAK,oB,mCAGZG,mBAAA,wBAA2B,E,CACUN,KAAA,CAAAC,OAAO,IAAID,KAAA,CAAAO,QAAQ,CAACC,MAAM,Q,cAA/DX,mBAAA,CAEM,OAFNY,UAEM,EAF+D,wCAErE,K,oCAEcT,KAAA,CAAAC,OAAO,IAAID,KAAA,CAAAO,QAAQ,CAACC,MAAM,Q,cAAxCX,mBAAA,CAqCQ,SArCRa,UAqCQ,G,0BApCJX,mBAAA,CASQ,gBARRA,mBAAA,CAOK,aANDA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAa,YAAT,MAAI,GACRA,mBAAA,CAAW,YAAP,IAAE,E,uBAGVA,mBAAA,CAyBQ,iB,kBAxBRF,mBAAA,CAuBKc,SAAA,QAAAC,WAAA,CAvBiBZ,KAAA,CAAAO,QAAQ,EAAnBM,OAAO;yBAAlBhB,mBAAA,CAuBK;MAvB4BiB,GAAG,EAAED,OAAO,CAACE;QAC1ChB,mBAAA,CAAyB,YAAAM,gBAAA,CAAlBQ,OAAO,CAACE,EAAE,kBACjBhB,mBAAA,CAA2B,YAAAM,gBAAA,CAApBQ,OAAO,CAACG,IAAI,kBACnBjB,mBAAA,CAAwC,YAApC,GAAC,GAAAM,gBAAA,CAAGQ,OAAO,CAACI,KAAK,CAACC,OAAO,qBAC7BnB,mBAAA,CAIK,aAHWc,OAAO,CAACM,MAAM,I,cAA1BtB,mBAAA,CAA2D,QAA3DuB,UAA2D,EAAT,IAAE,M,cACpDvB,mBAAA,CAA+C,QAA/CwB,UAA+C,EAAV,KAAG,IAC5BR,OAAO,CAACS,MAAM,I,cAA1BzB,mBAAA,CAA+D,QAA/D0B,UAA+D,EAAb,QAAM,K,qCAE5DxB,mBAAA,CAA4C,YAAAM,gBAAA,CAArCmB,QAAA,CAAAC,UAAU,CAACZ,OAAO,CAACa,SAAS,mBACnC3B,mBAAA,CAYK,aAXDO,mBAAA,UAAa,EACbP,mBAAA,CAAoE;MAAhE4B,IAAI,8BAA8Bd,OAAO,CAACE,EAAE;MAAEnB,KAAK,EAAC;OAAM,IAAE,iBAAAgC,UAAA,GAEhEtB,mBAAA,gBAAmB,EACnBP,mBAAA,CAMS;MALDH,KAAK,EAAAiC,eAAA,EAAC,KAAK;QAAA,iBACgBhB,OAAO,CAACM,MAAM;QAAA,gBAAkBN,OAAO,CAACM;MAAM;MACxEW,OAAK,EAAAC,MAAA,IAAEP,QAAA,CAAAQ,YAAY,CAACnB,OAAO;MAC3BoB,QAAQ,EAAEpB,OAAO,CAACM,MAAM,IAAIK,QAAA,CAAAU,sBAAsB;wBACpDrB,OAAO,CAACM,MAAM,8CAAAgB,WAAA,E;4EAOrBnC,KAAA,CAAAC,OAAO,IAAID,KAAA,CAAAO,QAAQ,CAACC,MAAM,U,cAAtCX,mBAAA,CAEM,OAFNuC,WAEM,EAFmE,UAEzE,K","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}